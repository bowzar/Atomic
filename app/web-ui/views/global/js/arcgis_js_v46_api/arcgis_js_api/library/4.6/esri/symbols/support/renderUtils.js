// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang dojo/Deferred dojox/gfx/matrix dojox/gfx ../../request ../../core/sniff ../../core/Error ../../core/promiseUtils ../../core/urlUtils ../../core/colorUtils ../../kernel".split(" "),function(J,v,A,B,C,D,E,K,F,x,G,w,y){function H(a){return a.map(function(e){return e.command+" "+e.values.join(",")}).join(" ").trim()}function I(a,e,d,m){var f=m&&m.node||document.createElement("div"),c=D.createSurface(f,e,d);null!=m.opacity&&(f.style.opacity=m.opacity.toString());
try{a.forEach(function(a){var p=c.createGroup(),h=0;a.forEach(function(a){var b=a.shape,c=a.fill,d=a.stroke;h+=d&&d.width||0;var e=null;b&&("path"===b.type&&"string"!==typeof b.path&&(b.path=H(b.path)),e=p.createShape(b).setFill(c).setStroke(d?d:{width:0}),"text"===b.type&&e.setFont(a.font))});var g=p.getBoundingBox();a=g.width;var q=g.height,l=-(g.x+a/2),b=-(g.y+q/2),k=c.getDimensions(),l={dx:l+k.width/2,dy:b+k.height/2},b=!1;if(m.scale&&0!==g.width&&0!==g.height){var b=g.width/g.height,f=(e>d?e:
d)-2*h,n=1,r=1;isNaN(f)||(1<b?(n=f/g.width,r=f/b/g.height):(r=f/g.height,n=f*b/g.width));p.applyTransform(C.scaleAt(n,r,k.width/2,k.height/2));b=!0}!b&&(a>e||q>d)&&(g=a/e>q/d,a=((g?e:d)-5)/(g?a:q),A.mixin(l,{xx:a,yy:a}));p.applyTransform(l)})}catch(r){return c.clear(),c.destroy(),null}return f}function z(a,e,d,m){if(!a)return x.reject(new F("renderUtils: imageDataSize","href not provided."));var f;if(G.isDataProtocol(a)){var c=new Image;c.src=a;if(c.complete)f=x.resolve({data:c});else{var r=new B;
f=r.promise;c.onload=function(){r.resolve({data:c})};c.onerror=r.reject}}else f=E(a,{responseType:"image",allowImageDataAccess:d});return f.then(function(a){a=a.data;var c=a.width,g=a.height,f=c/g,l=e;m&&(l=Math.min(l,Math.max(c,g)));return{image:d?a:null,width:1>=f?Math.ceil(l*f):l,height:1>=f?l:Math.ceil(l/f)}}).otherwise(function(c){if(d)return z(a,e,!1,m);throw c;})}Object.defineProperty(v,"__esModule",{value:!0});v.renderSymbol=function(a,e,d){var m=Math.ceil(e[0]);e=Math.ceil(e[1]);return a.some(function(a){return!!a.length})?
I(a,m,e,d):null};v.tintImageWithColor=function(a,e,d,m,f){return z(a,e,!!d,f).then(function(c){var f=c.width?c.width:e,p=c.height?c.height:e,h;if(h=c.image)h=d&&"ignore"!==m?"multiply"===m&&255===d.r&&255===d.g&&255===d.b&&1===d.a?!1:!0:!1;if(h){var g=c.image.width,q=c.image.height;/\.svg$/i.test(a)&&(--g,--q);var l,b;l=Math.ceil(f);b=Math.ceil(p);h=document.createElement("canvas");h.width=l;h.height=b;h.style.width=l+"px";h.style.height=b+"px";h=h.getContext("2d");h.clearRect(0,0,l,b);h.drawImage(c.image,
0,0,g,q,0,0,f,p);c=h.getImageData(0,0,f,p);g=[d.r/255,d.g/255,d.b/255,d.a];q=w.toHSV(d);for(l=0;l<c.data.length;l+=4){b=c.data;var k=l,t=g,n=q;switch(m){case "multiply":b[k+0]*=t[0];b[k+1]*=t[1];b[k+2]*=t[2];b[k+3]*=t[3];break;default:var u=w.toHSV({r:b[k+0],g:b[k+1],b:b[k+2]});u.h=n.h;u.s=n.s;u.v=u.v/100*n.v;n=w.toRGB(u);b[k+0]=n.r;b[k+1]=n.g;b[k+2]=n.b;b[k+3]*=t[3]}}h.putImageData(c,0,0);a=h.canvas.toDataURL("image/png")}else(h=y.id&&y.id.findCredential(a))&&h.token&&(c=-1===a.indexOf("?")?"?":
"\x26",a=""+a+c+"token\x3d"+h.token);return{url:a,width:f,height:p}}).otherwise(function(){return{url:a,width:e,height:e}})}});