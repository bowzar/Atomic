// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ./TextureCollection ./ResourceController ../../../core/watchUtils ../../../core/HandleRegistry ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(f,g,k,l,m,n,h){Object.defineProperty(g,"__esModule",{value:!0});f=function(){function c(a){this.streamDataSupplier=this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var b=l.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=
a.resourceController;this.streamDataSupplier=this.resourceController.registerClient(this,b);this.textures=new k(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=h.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=h.getLabelSettings(a.viewingMode)}c.prototype.destroy=function(){this.resourceController.deregisterClient(this);this.streamDataSupplier=this.textures=null};c.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);
var d=null;a.layerView&&(d=m.init(a.layerView,"layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}));return{remove:function(){d&&(d.remove(),d=null,b.updateScreenSizePerspectiveEnabled())}}};c.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,b=this.graphicsOwners.some(function(a){return a.layerView&&!0===a.layerView.get("layer.screenSizePerspectiveEnabled")});b&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new n,
b=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",b,!0),this.pointsOfInterest.events.on("camera-parameters-changed",b)]),this.updateScreenSizePerspectiveSettings()):!b&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};c.prototype.updateScreenSizePerspectiveSettings=function(){e.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;
e.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(e);this.screenSizePerspectiveSettingsLabels.update(e);this.stage.setNeedsRender()};return c}();g.SharedSymbolResources=f;var e={distance:0,fovY:0};g.default=f});