// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./input/DrawEvents ./Keys ../../../core/Accessor ./DrawAction ../../../core/Evented ../../../core/HandleRegistry ../../../geometry/ScreenPoint".split(" "),function(r,t,l,g,d,f,e,m,n,p,q,k){return function(h){function c(){var a=null!==h&&h.apply(this,arguments)||this;a._cursorMoved=!1;a._cursorScreenPoint=null;a._dragEnabled=!0;a._history=[];a._pointerDownEvent=
null;a._redoHistory=[];a._viewHandles=new q;a.vertices=[];a.view=null;return a}l(c,h);c.prototype.initialize=function(){this._addViewHandles()};c.prototype.destroy=function(){this._removeViewHandles();this._viewHandles.destroy();this.emit("destroy")};c.prototype.canUndo=function(){return 0<this._history.length};c.prototype.canRedo=function(){return 0<this._redoHistory.length};c.prototype.complete=function(){this._drawCompleteHandler(null)};c.prototype.undo=function(){if(this.canUndo()){var a=this._history.pop();
a.undo();this._redoHistory.push(a)}};c.prototype.redo=function(){if(this.canRedo()){var a=this._redoHistory.pop();a.redo();this._history.push(a)}};c.prototype._addViewHandles=function(){var a=this;this._removeViewHandles();this._viewHandles.add([this.view.on("pointer-down",function(b){a._cursorMoved&&a.vertices.pop();a._pointerDownEvent=b;a._cursorMoved=!1}),this.view.on("pointer-move",function(b){a._cursorMoved&&a.vertices.pop();a._cursorMoved=!0;a._cursorScreenPoint=new k({x:b.x,y:b.y});a._cursorUpdateHandler(b.native,
a.getCoordsFromScreenPoint(a._cursorScreenPoint))}),this.view.on("pointer-up",function(b){if(a._pointerDownEvent)if(a._cursorMoved)a.vertices.pop(),a._cursorMoved=!1;else{var c=new k({x:b.x,y:b.y});a._pointerDownEvent=null;a._vertexAddHandler(b.native,a.getCoordsFromScreenPoint(c))}}),this.view.on("drag",function(b){a._dragEnabled&&a._pointerDownEvent&&b.stopPropagation()}),this.view.on("double-click",function(b){b.stopPropagation();a._drawCompleteHandler(b.native)}),this.view.on("key-down",function(b){b.key===
e.KEYS.vertexAddKey&&!b.repeat&&a._cursorScreenPoint?(a._cursorMoved&&(a.vertices.pop(),a._cursorMoved=!1),a._vertexAddHandler(b.native,a.getCoordsFromScreenPoint(a._cursorScreenPoint))):b.key===e.KEYS.drawCompleteKey&&!b.repeat&&a._cursorScreenPoint?(a._cursorMoved&&(a.vertices.pop(),a._cursorMoved=!1),a._vertexAddHandler(b.native,a.getCoordsFromScreenPoint(a._cursorScreenPoint)),a._drawCompleteHandler(b.native)):b.key!==e.KEYS.undoKey||b.repeat?b.key!==e.KEYS.redoKey||b.repeat||a.redo():a.undo()})])};
c.prototype._removeViewHandles=function(){this._viewHandles.removeAll()};c.prototype._addVertex=function(a,b){this.vertices.splice(b,0,a)};c.prototype._removeVertex=function(a){this.vertices.splice(a,1)};c.prototype._undoVertexAdd=function(a,b,c){this._removeVertex(c);this.emit("vertex-remove",new f.VertexRemoveEvent(this.view,a,c,this.vertices))};c.prototype._redoVertexAdd=function(a,b,c){this._addVertex(b,c);this.emit("vertex-add",new f.VertexAddEvent(this.view,a,c,this.vertices))};c.prototype._vertexAddHandler=
function(a,b){var c=this;this.vertices.push(b);var d=this.vertices.indexOf(b);this._history.push({vertex:b,vertexIndex:d,undo:function(){return c._undoVertexAdd(a,b,d)},redo:function(){return c._redoVertexAdd(a,b,d)}});this._redoHistory=[];var e=new f.VertexAddEvent(this.view,a,d,this.vertices);this.emit("vertex-add",e);e.defaultPrevented&&(this._cursorMoved=!0,this._history.pop())};c.prototype._cursorUpdateHandler=function(a,b){this.vertices.push(b);b=this.vertices.indexOf(b);a=new f.CursorUpdateEvent(this.view,
a,b,this.vertices);this.emit("cursor-update",a)};c.prototype._drawCompleteHandler=function(a){this._cursorMoved=!1;this._pointerDownEvent=null;1>this.vertices.length||(a=new f.DrawCompleteEvent(a,this.vertices),this.emit("draw-complete",a),a.defaultPrevented?this._cursorMoved=!0:this._removeViewHandles())};g([d.property()],c.prototype,"vertices",void 0);g([d.property()],c.prototype,"view",void 0);return c=g([d.subclass("esri.views.2d.draw.MultipointDrawAction")],c)}(d.declared(n,m,p))});