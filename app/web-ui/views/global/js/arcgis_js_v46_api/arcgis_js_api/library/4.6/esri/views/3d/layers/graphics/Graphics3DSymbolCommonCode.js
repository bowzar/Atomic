// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../geometry/Point ../../../../symbols/callouts/calloutUtils ../../../../geometry/support/coordsUtils ./graphicUtils ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Object3D".split(" "),function(D,f,z,L,E,F,w,G,M){function A(b,a,d,c,e){var g=0,l=a.z||0,h=0,h=d.mode;c=d.calculateOffsetRenderUnits(c);d=d.featureExpressionInfoContext;"on-the-ground"===h?(g=h=b.getElevation(a,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=h)):"relative-to-ground"===
h?(h=b.getElevation(a,"ground")||0,g=c,null==d&&(g+=l),e&&(e.verticalDistanceToGround=g,e.terrainElevation=h),g+=h):"relative-to-scene"===h?(h=b.getElevation(a,"scene")||0,g=c,e&&(e.verticalDistanceToGround=g,e.terrainElevation=h),g+=h):"absolute-height"===h&&(g=c,null==d&&(g+=l),e&&(h=b.getElevation(a,"ground")||0,e.verticalDistanceToGround=g-h,e.terrainElevation=h));return g}function H(b){for(var a=0,d=b.length-1,c=0;c<d;c++)a+=b[c][0]*b[c+1][1]-b[c+1][0]*b[c][1];return 0<=a}function x(b,a,d,c,
e,g){c*=3;for(var l=0;l<e;++l){var h=b[a++];d[c++]=h[0];d[c++]=h[1];d[c++]=g?h[2]:0}return c/3}function B(b,a){for(var d=b.length,c=Array(d),e=Array(d),g=Array(d),l=0,h=0,f=0,q=0,m=0;m<d;++m)q+=b[m].length;for(var q=new Float64Array(3*q),p=0,t=d-1;0<=t;t--){var k=b[t];if(H(k))c[l++]=k;else{for(var n=k.length,m=0;m<l;++m)n+=c[m].length;m={index:p,pathLengths:Array(l+1),count:n,holeIndices:Array(l)};m.pathLengths[0]=k.length;0<k.length&&(g[f++]={index:p,count:k.length});p=x(k,0,q,p,k.length,a);for(k=
0;k<l;++k)n=c[k],m.holeIndices[k]=p,m.pathLengths[k+1]=n.length,0<n.length&&(g[f++]={index:p,count:n.length}),p=x(n,0,q,p,n.length,a);l=0;0<m.count&&(e[h++]=m)}}for(k=0;k<l;++k)n=c[k],0<n.length&&(g[f++]={index:p,count:n.length}),p=x(n,0,q,p,n.length,a);h<d&&(e.length=h);f<d&&(g.length=f);return{vertexData:q,polygons:e,outlines:g}}function I(b,a,d,c,e){a*=3;c*=3;for(var g=0;g<e;++g)d[c++]=b[a++],d[c++]=b[a++],d[c++]=b[a++]}function C(b,a,d,c,e,g,l){return w.bufferToBuffer(b,d,a,c,g,e,l)}function y(b,
a,d){w.pointToVector(b,a,d)}function J(b,a){return!(b[0]>a[3]||b[0]<a[0]||b[1]>a[4]||b[1]<a[1])}function K(b,a){return!(a[0]>b[3]||a[3]<b[0]||a[1]>b[4]||a[4]<b[1])}Object.defineProperty(f,"__esModule",{value:!0});D=G.mat4d;var r=G.vec3d.create(),N=D.identity(),u=new z({x:0,y:0,z:0,spatialReference:null});f.createStageObjectForPoint=function(b,a,d,c,e,g,l,h,f,q,m){var p=a?a.length:0,t=this._context.clippingExtent;y(b,r,this._context.elevationProvider.spatialReference);if(t&&!J(r,t))return null;y(b,
r,this._context.renderSpatialReference);t=this._context.localOriginFactory.getOrigin(r);l=new M({castShadow:!1,metadata:{layerUid:h,graphicId:f,usesVerticalDistanceToGround:!!q},idHint:l});for(h=0;h<p;h++)l.addGeometry(a[h],d[h],c?c[h]:N,e,t,m);a=this._context.renderSpatialReference;c=this._context.elevationProvider;e=this._context.renderCoordsHelper;d=0;var k;l.metadata.usesVerticalDistanceToGround?(d=A(c,b,g,e,v),F.updateVertexAttributeAuxpos1w(l,v.verticalDistanceToGround),k=v.terrainElevation):
(m="absolute-height"!==g.mode,d=A(c,b,g,e,m?v:null),m&&(k=v.terrainElevation));g=l.getObjectTransformation();r[0]=b.x;r[1]=b.y;r[2]=d;w.computeLinearTransformation(b.spatialReference,r,g,a)?l.setObjectTransformation(g):console.warn("Could not locate symbol object properly, it might be misplaced");return{object:l,terrainElevation:k}};f.extendPointGraphicElevationContext=function(b,a,d){b=b.elevationContext;d=d.spatialReference;y(a,r,d);b.centerPointInElevationSR=new z({x:r[0],y:r[1],z:a.hasZ?r[2]:
0,spatialReference:d})};f.placePointOnPolyline=function(b){var a=b.paths[0];if(!a||0===a.length)return null;a=E.getPointOnPath(a,E.getPathLength(a)/2);return new z({x:a[0],y:a[1],z:a[2],spatialReference:b.spatialReference})};f.placePointOnPolygon=function(b){return F.computeCentroid(b)};f.computeElevation=A;f.getSingleSizeDriver=function(b,a){void 0===a&&(a=0);return isFinite(b[a])?b[a]:null};f.isCounterClockwise=H;f.copyPointData=x;f.copyPathData=B;f.copyVertices=I;f.chooseOrigin=function(b,a,d,
c){a=Math.floor(a+(d-1)/2);c[0]=b[3*a+0];c[1]=b[3*a+1];c[2]=b[3*a+2]};f.subtractCoordinates=function(b,a,d,c){a*=3;for(var e=0;e<d;++e)b[a++]-=c[0],b[a++]-=c[1],b[a++]-=c[2]};f.setZ=function(b,a,d,c){a*=3;for(var e=0;e<d;++e)b[a+2]=c,a+=3};f.offsetZ=function(b,a,d,c){a*=3;for(var e=0;e<d;++e)b[a+2]+=c,a+=3};f.scaleZ=function(b,a,d,c){a*=3;for(var e=0;e<d;++e)b[a+2]*=c,a+=3};f.flatArrayToArrayOfArrays=function(b,a,d){var c=[];a*=3;for(var e=0;e<d;++e)c.push([b[a++],b[a++],b[a++]]);return c};f.reproject=
C;f.reprojectPoint=y;f.getGeometryVertexData3D=function(b,a,d,c,e,g,f){var h=e.spatialReference;b=B(b,a);a=b.vertexData;var l=a.length/3,q=new Float64Array(a.length),m=!0;d.equals(h)?I(a,0,q,0,a.length):m=C(a,0,d,q,0,h,l);var p=d=0,t=f.mode,k=0,n=0,r=0;g=f.calculateOffsetRenderUnits(g);f=f.featureExpressionInfoContext;u.spatialReference=e.spatialReference;d*=3;for(var p=3*p,v=0;v<l;++v)u.x=q[d+0],u.y=q[d+1],u.z=q[d+2],"on-the-ground"===t?(n=k=e.getElevation(u)||0,r+=k):"relative-to-ground"===t?(k=
e.getElevation(u)||0,n=k+g,null==f&&(n+=u.z),r+=k):"relative-to-scene"===t?(k=e.getElevation(u,"scene")||0,n=k+g,r+=k):"absolute-height"===t&&(n=g,null==f&&(n+=u.z)),a[p+0]=q[d+0],a[p+1]=q[d+1],a[p+2]=n,d+=3,p+=3;e=r/l;h.equals(c)||C(a,0,h,a,0,c,l);return{geometryData:b,vertexData:a,eleVertexData:q,terrainElevation:e,projectionSuccess:m}};f.getGeometryVertexDataDraped=function(b,a,d){b=B(b,!1);var c=b.vertexData,e=c.length/3,g=!0;a.equals(d)||(g=w.bufferToBuffer(c,a,0,c,d,0,e));return{geometryData:b,
vertexData:c,projectionSuccess:g}};f.computeBoundingBox=function(b,a,d,c){c[0]=Number.MAX_VALUE;c[1]=Number.MAX_VALUE;c[2]=Number.MAX_VALUE;c[3]=-Number.MAX_VALUE;c[4]=-Number.MAX_VALUE;c[5]=-Number.MAX_VALUE;a*=3;for(var e=0;e<d;++e){var g=b[a++],f=b[a++],h=b[a++];g<c[0]&&(c[0]=g);f<c[1]&&(c[1]=f);h<c[2]&&(c[2]=h);g>c[3]&&(c[3]=g);f>c[4]&&(c[4]=f);h>c[5]&&(c[5]=h)}return c};f.pointInBox2D=J;f.boxesIntersect2D=K;f.boundingBoxClipped=function(b,a){return a?!K(b,a):!1};f.needsElevationUpdates2D=function(b){return"relative-to-ground"===
b||"relative-to-scene"===b};f.needsElevationUpdates3D=function(b){return"absolute-height"!==b};f.needsOffsetAdjustment=function(b,a,d,c){if(!1===a.needsOffsetAdjustment||!1===a.supportsOffsetAdjustment||"on-the-ground"===b.mode)return!1;if(0===b.meterUnitOffset){if(!0===a.needsOffsetAdjustment)return!0;if(L.isCalloutSupport(c)&&c.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===b.mode&&(!d.hasZ||b.featureExpressionInfoContext)||"relative-to-scene"===b.mode)return!0}return!1};var v={verticalDistanceToGround:0,
terrainElevation:0}});