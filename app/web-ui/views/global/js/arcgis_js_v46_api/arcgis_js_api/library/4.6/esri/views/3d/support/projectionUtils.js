// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("../../../geometry/SpatialReference ../../../geometry/Point ./mathUtils ./earthUtils ../lib/glMatrix ../webgl-engine/lib/BufferVectorMath".split(" "),function(v,I,w,C,D,J){var z=D.vec3d,x=D.mat4d,K=J.Vec3Compact,d=z.create(),k=z.create(),q=z.create(),m=w.deg2rad(1),r=w.rad2deg(1),E,p,F,y,G=new v({wkt:'\r\n      GEOCCS["Spherical geocentric",\r\n        DATUM["Not specified",\r\n          SPHEROID["Sphere",'+C.earthRadius+',0]],\r\n        PRIMEM["Greenwich",0.0,\r\n          AUTHORITY["EPSG","8901"]],\r\n        UNIT["m",1.0],\r\n        AXIS["Geocentric X",OTHER],\r\n        AXIS["Geocentric Y",EAST],\r\n        AXIS["Geocentric Z",NORTH]\r\n      ]\r\n    '}),
H=new v({wkt:'\r\n      GEOCCS["WGS 84",\r\n        DATUM["WGS_1984",\r\n          SPHEROID["WGS 84",6378137,298.257223563,\r\n            AUTHORITY["EPSG","7030"]],\r\n          AUTHORITY["EPSG","6326"]],\r\n        PRIMEM["Greenwich",0,\r\n          AUTHORITY["EPSG","8901"]],\r\n        UNIT["m",1.0,\r\n          AUTHORITY["EPSG","9001"]],\r\n        AXIS["Geocentric X",OTHER],\r\n        AXIS["Geocentric Y",OTHER],\r\n        AXIS["Geocentric Z",NORTH],\r\n        AUTHORITY["EPSG","4978"]\r\n      ]\r\n    '}),
g=C.earthRadius,t=function(a){return a===G?1:a.isWGS84?2:a.isWebMercator?3:a===H?4:0};v=function(a,c,b,e){b[e++]=a[c++];b[e++]=a[c++];b[e]=a[c]};var A=function(a,c,b,e){var h=.4999999*Math.PI,f=m*a[c+1],f=w.clamp(f,-h,h),h=Math.sin(f);b[e++]=m*a[c]*g;b[e++]=g/2*Math.log((1+h)/(1-h));b[e]=a[c+2]},B=function(a,c,b,e){var h=g+a[c+2],f=m*a[c+1];a=m*a[c];c=Math.cos(f);b[e++]=Math.cos(a)*c*h;b[e++]=Math.sin(a)*c*h;b[e]=Math.sin(f)*h},L=[void 0,B,v,A,function(a,c,b,e){var h=m*a[c],f=m*a[c+1];a=a[c+2];c=
Math.sin(f);var f=Math.cos(f),d=6378137/Math.sqrt(1-.006694379990137799*c*c);b[e++]=(d+a)*f*Math.cos(h);b[e++]=(d+a)*f*Math.sin(h);b[e++]=(.9933056200098622*d+a)*c}],u=[void 0,function(a,c,b,e){var h=K.length(a,c),f=w.asin(a[c+2]/h);a=(0<a[c+1]?1:-1)*w.acos(a[c]/(Math.cos(f)*h));b[e++]=r*a;b[e++]=r*f;b[e]=h-g},v,function(a,c,b,e){b[e++]=r*(a[c++]/g);b[e++]=r*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/g)));b[e]=a[c]},function(a,c,b,e){var h=a[c],f=a[c+1];a=a[c+2];var d,k,l,n,g,m,p;c=Math.abs(a);d=h*
h+f*f;k=Math.sqrt(d);l=d+a*a;n=Math.sqrt(l);h=Math.atan2(f,h);g=a*a/l;l=d/l;f=1.8230912546075456E9/n;d=142.91722289812412-4.557728136518864E9/n;.3<l?(g=c/n*(1+l*(42697.67270715754+f+g*d)/n),n=Math.asin(g),f=g*g,l=Math.sqrt(1-f)):(l=k/n*(1-g*(42840.589930055656-f-l*d)/n),n=Math.acos(l),f=1-l*l,g=Math.sqrt(f));m=1-.006694379990137799*f;f=6378137/Math.sqrt(m);p=.9933056200098622*f;f=k-f*l;d=c-p*g;c=l*f+g*d;k=l*d-g*f;f=k/(p/m+c);n+=f;0>a&&(n=-n);b[e++]=r*h;b[e++]=r*n;b[e]=c+k*f/2}];return{SphericalECEFSpatialReference:G,
WGS84ECEFSpatialReference:H,vectorToVector:function(a,c,b,e){2===a.length?(d[0]=a[0],d[1]=a[1],d[2]=0,a=d):a===b&&(z.set(a,d),a=d);return this.bufferToBuffer(a,c,0,b,e,0,1)},pointToVector:function(a,c,b){d[0]=a.x;d[1]=a.y;var e=a.z;d[2]=void 0!==e?e:0;return this.bufferToBuffer(d,a.spatialReference,0,c,b,0,1)},vectorToPoint:function(a,c,b,e){"esri.SpatialReference"===b.declaredClass?(e=b,b=new I({spatialReference:e})):e=e||b.spatialReference;return this.bufferToBuffer(a,c,0,d,e,0,1)?(b.x=d[0],b.y=
d[1],b.z=d[2],b.spatialReference=e,b):null},xyzToVector:function(a,c,b,e,h,f){d[0]=a;d[1]=c;d[2]=b;return this.bufferToBuffer(d,e,0,h,f,0,1)},bufferToBuffer:function(a,c,b,e,d,f,g){g=g||1;E!==c&&(p=t(c),E=c);F!==d&&(y=t(d),F=d);g=b+3*g;if(p!==y||0===p&&!c.equals(d))if(0<p&&0<y)if(2!==y){var h=L[y];if(2!==p)for(d=u[p];b<g;b+=3,f+=3)d(a,b,k,0,c.wkid),h(k,0,e,f);else for(;b<g;b+=3,f+=3)h(a,b,e,f)}else for(d=u[p];b<g;b+=3,f+=3)d(a,b,e,f,c.wkid);else return!1;else if(e!==a||b!==f)for(;b<g;b++,f++)e[f]=
a[b];return!0},computeLinearTransformation:function(a,c,b,e){var d=t(a),f=t(e);if(d===f&&(0!==d||a.equals(e)))return x.identity(b),x.translate(b,c),!0;if(1===f){if(e=u[d])return e(c,0,k,0,a.wkid),B(k,0,q,0),e=m*k[0],c=m*k[1],a=Math.sin(e),e=Math.cos(e),d=Math.sin(c),c=Math.cos(c),b[0]=-a,b[4]=-d*e,b[8]=c*e,b[12]=q[0],b[1]=e,b[5]=-d*a,b[9]=c*a,b[13]=q[1],b[2]=0,b[6]=c,b[10]=d,b[14]=q[2],b[3]=0,b[7]=0,b[11]=0,b[15]=1,!0}else if(3===f&&(2===d||1===d))return u[d](c,0,k,0,a.wkid),a=m*k[1],A(k,0,q,0),x.identity(b),
x.translate(b,q),a=1/Math.cos(a),x.scale(b,[a,a,1]),!0;return!1},mbsToMbs:function(a,c,b,d){var e=t(c),f=t(d);if(e===f&&(0!==e||c.equals(d)))return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(1===f){if(d=u[e])return d(a,0,k,0,c.wkid),B(k,0,b,0),b[3]=a[3],!0}else if(3===f&&(2===e||1===e))return u[e](a,0,k,0,c.wkid),c=m*k[1],c=Math.abs(c)+Math.asin(a[3]/(g+a[2])),A(k,0,b,0),b[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*a[3],!0;return!1},extentToBoundingBox:function(a,c,b){if(null==a)return!1;
var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=this.bufferToBuffer(d,a.spatialReference,0,c,b,0,1);d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&this.bufferToBuffer(d,a.spatialReference,0,c,b,3,1);null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);return e},extentToBoundingRect:function(a,
c,b){if(null==a)return!1;var e;d[0]=null!=a.xmin?a.xmin:0;d[1]=null!=a.ymin?a.ymin:0;d[2]=null!=a.zmin?a.zmin:0;e=this.bufferToBuffer(d,a.spatialReference,0,d,b,0,1);c[0]=d[0];c[1]=d[1];d[0]=null!=a.xmax?a.xmax:0;d[1]=null!=a.ymax?a.ymax:0;d[2]=null!=a.zmax?a.zmax:0;e=e&&this.bufferToBuffer(d,a.spatialReference,0,d,b,0,1);c[2]=d[0];c[3]=d[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=Infinity);null==a.ymax&&(c[3]=Infinity);return e},webMercator:{x2lon:function(a){return a/
g},y2lat:function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/g))},lon2x:function(a){return a*g},lat2y:function(a){a=Math.sin(a);return g/2*Math.log((1+a)/(1-a))}}}});