// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ./Texture ./TextTexture ./ModelContentType ../../../webgl/Texture ../../../webgl/enums".split(" "),function(r,t,n,p,l,q,u){var b=p.preferredAtlasSize(),m=function(){function a(a){this.textTextures={};this.dirty=!1;this._glTexture=null;this.id=n.idGen.gen(a)}a.prototype.getId=function(){return this.id};a.prototype.dispose=function(){};a.prototype.deferredLoading=function(){return!1};a.prototype.getWidth=function(){return b};a.prototype.getHeight=function(){return b};a.prototype.initializeThroughRender=
function(a,b){b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;var f=this._drawToCanvas();this._glTexture=new q(a,b,f);this.dirty=!1;return this._glTexture};a.prototype.redraw=function(){if(this.dirty&&this._glTexture){var a=this._drawToCanvas();this._glTexture.setData(a);this.dirty=!1}};a.prototype.setUnloadFunc=function(a){this._unloadFunc=a};a.prototype.unload=function(){null!=this._unloadFunc&&(this._unloadFunc(this.id),this._unloadFunc=null)};a.prototype._drawToCanvas=
function(){var f=a._create2Dcanvas(),h=f.getContext("2d");h.clearRect(0,0,b,b);for(var c in this.textTextures){var d=this.textTextures[c];d.textTexture.renderText(d.placement.width,d.placement.height,h,d.placement.atlasOffX,d.placement.atlasOffY)}return f};a._create2Dcanvas=function(){a._textCanvas2D||(a._textCanvas2D=document.createElement("canvas"),a._textCanvas2D.setAttribute("id","canvas2d"),a._textCanvas2D.setAttribute("width",b.toString()),a._textCanvas2D.setAttribute("height",b.toString()),
a._textCanvas2D.setAttribute("style","display:none"));return a._textCanvas2D};return a}();return function(){function a(a,b){this._textureAtlasSubtextures=[];this._curLineHeight=this._curY=this._curX=0;this._idHint=a;this._stage=b}a.prototype.dispose=function(){for(var a=0;a<this._textureAtlasSubtextures.length;a++)this._stage.remove(l.TEXTURE,this._textureAtlasSubtextures[a].getId());this._textureAtlasSubtextures=[]};a.prototype.canHoldTextTexture=function(a){return a.getRenderedWidth()<=b&&a.getRenderedHeight()<=
b};a.prototype.addTextTexture=function(a){for(var h=JSON.stringify(a.getParams())+"_"+a.getText(),c=0;c<this._textureAtlasSubtextures.length;c++){var d=this._textureAtlasSubtextures[c].textTextures[h];if(null!=d)return d.placement}var e=null;0===this._textureAtlasSubtextures.length&&(e=new m(this._idHint),this._textureAtlasSubtextures.push(e));var c=a.getRenderedWidth(),d=a.getRenderedHeight(),f=c+2,g=d+2+2,k;this._curLineHeight=Math.max(this._curLineHeight,g);this._curX+f<b&&this._curY+this._curLineHeight<
b||(this._curY+this._curLineHeight+g<b?(this._curX=0,this._curY+=this._curLineHeight):(e=new m(this._idHint),this._textureAtlasSubtextures.push(e),this._curY=this._curX=0,this._curLineHeight=g));g=this._curX;k=this._curY;this._curX+=f;null!=e&&this._stage.add(l.TEXTURE,e);e=this._textureAtlasSubtextures[this._textureAtlasSubtextures.length-1];c={uvMinMax:[g/b,1-(k+d)/b,(g+c)/b,1-k/b],atlasOffX:g,atlasOffY:k,width:c,height:d,texture:e};e.textTextures[h]={placement:c,textTexture:a};e.dirty=!0;return c};
return a}()});