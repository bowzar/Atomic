// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ./classBreaks ../../../core/promiseUtils ./support/utils ../support/utils ../../../layers/support/fieldUtils".split(" "),function(t,u,m,n,e,c,g,k){function p(b){if(!(b&&b.layer&&(b.field||b.valueExpression||b.sqlExpression)))return e.reject(c.createError("summary-statistics:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required"));var a=m.mixin({},b);a.normalizationType=c.getNormalizationType(a);b=[0,1,2];var f=
g.createLayerAdapter(a.layer,b);return(a.layer=f)?f.load().then(function(){var b=a.field,l=a.normalizationType,h=a.valueExpression||a.sqlExpression,b=b?f.getField(b):null,d=g.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression});if(d=c.verifyBasicFieldValidity(f,d,"summary-statistics:invalid-parameters"))return e.reject(d);if(b){if(h=c.verifyFieldType(f,b,"summary-statistics:invalid-parameters",q))return e.reject(h);if(k.isDateField(b)&&l)return e.reject(c.createError("summary-statistics:invalid-parameters",
"Normalization is not allowed for date fields"))}else if(h&&l)return e.reject(c.createError("summary-statistics:invalid-parameters","Normalization is not allowed when 'valueExpression' or 'sqlExpression' is specified"));return a}):e.reject(c.createError("summary-statistics:invalid-parameters","'layer' must be one of these types: "+g.getLayerTypeLabels(b).join(", ")))}function r(b){var a=b.normalizationType,c=b.normalizationField;return n({layer:b.layer,field:b.field,classificationMethod:"standard-deviation",
standardDeviationInterval:.25,normalizationType:a,normalizationField:"field"===a?c:void 0,minValue:b.minValue,maxValue:b.maxValue}).then(function(a){var b,c,d;a.classBreakInfos.some(function(a){a.hasAvg&&(b=a);return!!b});b&&(d=b.maxValue-b.minValue,c=b.minValue+d/2,d*=4);return{min:a.minValue,max:a.maxValue,avg:c,stddev:d}}).then(g.processSummaryStatisticsResult)}var q=[].concat(k.numericTypes).concat("date");return function(b){return p(b).then(function(a){return a.normalizationType?r(a):a.layer.summaryStatistics({field:a.field,
valueExpression:a.valueExpression,sqlExpression:a.sqlExpression,sqlWhere:a.sqlWhere,minValue:a.minValue,maxValue:a.maxValue,features:a.features})})}});