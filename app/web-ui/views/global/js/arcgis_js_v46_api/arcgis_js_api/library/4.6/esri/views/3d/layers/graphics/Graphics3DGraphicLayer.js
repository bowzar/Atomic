// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Graphics3DGraphicElevationContext ./featureExpressionInfoUtils ../../webgl-engine/Stage ../../lib/glMatrix ../../support/aaBoundingBox".split(" "),function(v,C,D,w,x,y,z,f,m,g){v=m.vec3d;var A=m.mat4d,u=[0,0,0];m=function(){function c(a,b,f,g,e,k,l,d){this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=
a;this.uniqueMaterials=g;this.uniqueGeometries=f;this.uniqueTextures=e;this.stageObject=b;this.elevationAligner=k;this.elevationContext=new y(l);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=d?d:c.VisibilityModes.HIDE_FACERANGE}c.prototype.initialize=function(a,b){this.stageLayer=a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(f.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(f.ModelContentType.GEOMETRY,
this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(f.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(f.ModelContentType.OBJECT,this.stageObject)};c.prototype.isDraped=function(){return!1};c.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===c.VisibilityModes.HIDE_FACERANGE?
this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),!0):!1};c.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(f.ModelContentType.MATERIAL,this.uniqueMaterials[b].getId());if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(f.ModelContentType.GEOMETRY,this.uniqueGeometries[b].getId());if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(f.ModelContentType.TEXTURE,
this.uniqueTextures[b].getId())}a.remove(f.ModelContentType.OBJECT,this.stageObject.getId());this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);this._visible=!1;this.stage=this.stageLayer=null};c.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(z.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this.stageObject,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};c.prototype.setDrawOrder=
function(a,b,c){};c.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};c.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};c.prototype.getBoundingBoxObjectSpace=function(a){var b=this.stageObject;a||(a=g.create());g.setMin(a,b.getBBMin(!0));g.setMax(a,b.getBBMax(!0));return a};c.prototype.getProjectedBoundingBox=function(a,b,c,f){return x(this,void 0,void 0,function(){var e,m,q,d,r,t,h,p;return w(this,function(n){switch(n.label){case 0:e=this.getBoundingBoxObjectSpace(c);
m=B;q=g.isPoint(e)?1:m.length;for(d=0;d<q;d++)r=m[d],k[0]=e[r[0]],k[1]=e[r[1]],k[2]=e[r[2]],A.multiplyVec3(this.stageObject.objectTransformation,k),l[3*d+0]=k[0],l[3*d+1]=k[1],l[3*d+2]=k[2];if(!a(l,0,q))return[3,6];g.set(e,g.NEGATIVE_INFINITY);t=null;this.calculateRelativeScreenBounds&&(t=this.calculateRelativeScreenBounds());for(d=0;d<3*q;d+=3){for(h=0;3>h;h++)e[h]=Math.min(e[h],l[d+h]),e[h+3]=Math.max(e[h+3],l[d+h]);t&&f.push({location:l.slice(d,d+3),screenSpaceBoundingRect:t})}if(!b)return[3,5];
g.center(e,u);if("absolute-height"===this.elevationContext.mode)return[3,5];p=void 0;n.label=1;case 1:return n.trys.push([1,3,,4]),[4,b.queryElevation(u[0],u[1])];case 2:return p=n.sent(),[3,4];case 3:return n.sent(),p=null,[3,4];case 4:null!=p&&g.offset(e,0,0,-this.alignedTerrainElevation+p),n.label=5;case 5:return[2,e];case 6:return[2,null]}})})};c.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};c.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};
c.VisibilityModes={REMOVE_OBJECT:0,HIDE_FACERANGE:1};return c}();var l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],k=v.create(),B=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return m});