// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/Accessor ../../viewpointUtils ../../../navigation/Momentum ../../../3d/lib/glMatrix".split(" "),function(p,q,k,f,e,l,g,m,n){return function(h){function b(b){var a=h.call(this)||this;a.animationTime=0;a.momentumEstimator=new m.ScreenspaceMomentumEstimator(.05,600,6,.92);a.momentum=null;a.momentumVelocityX=0;a.momentumVelocityY=
0;a.momentumFinished=!1;a.viewpoint=g.create();a.watch("momentumFinished",function(c){c&&a.navigation.stop()});return a}k(b,h);b.prototype.begin=function(b,a){this.navigation.begin();this.momentumEstimator.reset();this.addToEstimator(a)};b.prototype.update=function(b,a){this.addToEstimator(a);var c=a.pointers[0];a=c.currentEvent.x;var d=c.currentEvent.y;a=(c=c.previousEvent)?c.x-a:-a;d=c?d-c.y:d;b.viewpoint=g.translateBy(this.viewpoint,b.viewpoint,[a||0,d||0])};b.prototype.end=function(b,a){this.addToEstimator(a);
this.momentum=this.momentumEstimator.evaluateMomentum();this.animationTime=0;this.momentum&&(this.momentumVelocityX=(this.momentum.dataNewest[0]-this.momentum.dataOldest[0])/this.momentum.dataTimeDelta,this.momentumVelocityY=(this.momentum.dataNewest[1]-this.momentum.dataOldest[1])/this.momentum.dataTimeDelta,this.onAnimationUpdate(b));this.navigation.end()};b.prototype.addToEstimator=function(b){var a=b.pointers[0],c=a.currentEvent.x,a=a.currentEvent.y;this.momentumEstimator.add(c,a,n.vec3.createFrom(c,
a,0),.001*b.currentState.timestamp)};b.prototype.onAnimationUpdate=function(b){var a=this;this.navigation.animationManager.animateContinous(b.viewpoint,function(c,d){a.momentumFinished=!a.momentum||a.momentum.isFinished(a.animationTime);d*=.001;if(!a.momentumFinished){var e=a.momentum.velocityFactor(a.animationTime);b.viewpoint=g.translateBy(c,c,[-(e*a.momentumVelocityX*d),e*a.momentumVelocityY*d])}a.animationTime+=d})};b.prototype.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),
this.momentum=null,this.navigation.stop())};f([e.property()],b.prototype,"momentumFinished",void 0);f([e.property()],b.prototype,"viewpoint",void 0);f([e.property()],b.prototype,"navigation",void 0);return b=f([e.subclass("esri.views.2d.navigation.actions.Pan")],b)}(e.declared(l))});