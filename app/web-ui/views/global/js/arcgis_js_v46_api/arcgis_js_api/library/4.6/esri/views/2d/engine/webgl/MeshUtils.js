// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/ArrayPool ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ./Utils ./visualVariablesUtils ./MeshData ./enums ./lineMeshUtil".split(" "),function(M,C,G,E,J,d,K,H,F,L){Object.defineProperty(C,"__esModule",{value:!0});var z=new Float32Array(1),A=new Uint32Array(z.buffer);C.createTextMesh=function(d,k,v,q,z,y,r){return null};C.createMesh=function(m,k,v,q,B,y,r,x,p,a){switch(B){case F.WGLGeometryType.MARKER:B=H.pool.acquire();var e,h,t=0,u=0,g,c,
n,f,b;(y=k.heatmapInfo)?(a=Math.round(k.heatmapInfo.radius),x=q=0,h=e=a,g=[1,1,1,1],c=[0,0,0,0],f=n=a,b=0):(h=q.spriteMosaicItem,q=Math.round(h.rect.x/4),x=Math.round(h.rect.y/4),e=q+Math.round(h.rect.width/4),h=x+Math.round(h.rect.height/4),t=a.xoffset|0,u=a.yoffset|0,g=d.isPictureSymbol(a)?[255,255,255,255]:d.copyAndPremultiply(a.color),n=Math.round(E.pt2px(a.width||a.size)),f=Math.round(E.pt2px(a.height||a.size)),a.outline?(c=null!=a.outline.color?d.copyAndPremultiply(a.outline.color):[255,255,
255,255],b=null!=a.outline.width?Math.round(E.pt2px(a.outline.width)):0):(c=[0,0,0,0],b=0));var l=p.centroid||p.geometry;a=[];r=d.i1616to32(l.x+t*r,l.y+u*r);t=d.i8888to32(g[0],g[1],g[2],g[3]);c=d.i8888to32(c[0],c[1],c[2],c[3]);n=d.i8888to32(n,f,b,0);m=d.numTo32(m);var w=b=0;f=g=l=0;if(u=v.vvColor||v.vvOpacity||v.vvRotation||v.vvSizeMinMaxValue||v.vvSizeScaleStops||v.vvSizeFieldStops||v.vvSizeUnitValue)b=k.vvFields,l=b.rotation?k.getValue(p,b.rotation):0,w=b.opacity?k.getValue(p,b.opacity):0,g=b.color?
k.getValue(p,b.color):0,b=b.size&&!v.vvSizeScaleStops?k.getValue(p,b.size):0,v.vvSizeUnitValue&&(b=K.getVisualVariableSizeValueRepresentationRatio(b,k.vvRanges.size.unitValue.valueRepresentation)),isNaN(b)&&(b=1),isNaN(l)&&(l=1),isNaN(w)&&(w=1),isNaN(g)&&(g=1),z[0]=b,b=A[0],z[0]=w,w=A[0],z[0]=l,l=A[0],z[0]=g,g=A[0];y&&(z[0]=k.heatmapInfo.getIntensity(p),f=A[0]);a.push(r);a.push(d.i8888to32(-32,-32,q,x));a.push(m);a.push(t);a.push(c);a.push(n);u?(a.push(b),a.push(g),a.push(w),a.push(l)):y&&a.push(f);
a.push(r);a.push(d.i8888to32(32,-32,e,x));a.push(m);a.push(t);a.push(c);a.push(n);u?(a.push(b),a.push(g),a.push(w),a.push(l)):y&&a.push(f);a.push(r);a.push(d.i8888to32(-32,32,q,h));a.push(m);a.push(t);a.push(c);a.push(n);u?(a.push(b),a.push(g),a.push(w),a.push(l)):y&&a.push(f);a.push(r);a.push(d.i8888to32(32,32,e,h));a.push(m);a.push(t);a.push(c);a.push(n);u?(a.push(b),a.push(g),a.push(w),a.push(l)):y&&a.push(f);B.update({geometry:a},4,[0,1,2,1,3,2]);return B;case F.WGLGeometryType.FILL:B=H.pool.acquire();
c=null!=q?q.spriteMosaicItem:null;t=p.geometry;r=d.isPictureSymbol(a);h=!r&&a.color?d.copyAndPremultiply(a.color):[255,255,255,255];y=d.numTo32(m);v=v.vvColor||v.vvOpacity;x=q=0;v&&(x=k.vvFields,q=x.opacity?k.getValue(p,x.opacity):0,k=x.color?k.getValue(p,x.color):0,isNaN(q)&&(q=1),isNaN(k)&&(k=1),z[0]=q,q=A[0],z[0]=k,x=A[0]);k=d.i8888to32(h[0],h[1],h[2],h[3]);p=[0,0];h=[0,0];c&&(m=c.rect.x,n=c.rect.y,f=c.width,c=c.height,p[0]=m+1,p[1]=n+1,h[0]=m+1+f,h[1]=n+1+c);a=r&&a.width&&a.height?[d.nextHighestPowerOfTwo(a.width),
d.nextHighestPowerOfTwo(a.height),0,0]:[d.nextHighestPowerOfTwo(h[0]-p[0]),d.nextHighestPowerOfTwo(h[1]-p[1]),0,0];a=d.i8888to32(a[0],a[1],a[2],a[3]);m=G.acquire();r=[];n=c=0;for(t=t.rings;n<t.length;n++){f=t[n];u=c;g=0;b=f.length;l=f[0][0];w=f[0][1];m.push(l);m.push(w);c++;c++;for(var D=1;D<b;++D){var C=f[D][0],I=f[D][1];g-=C*(w+w+I);l+=C;w+=I;m.push(l);m.push(w);c++;c++}0<g?(e&&r.push(e),e={holeIndices:[],offset:u,coordCount:2*b}):0>g?e&&(e.holeIndices.push((u-e.offset)/2),e.coordCount+=2*b):(c=
u,m.splice(u))}e&&r.push(e);e=[];t=[];for(n=c=0;n<r.length;n++)if(f=r[n],b=m.slice(f.offset,f.offset+f.coordCount),u=J(b,f.holeIndices,2),g=u.length,0<g){for(l=0;l<f.coordCount;)e.push(d.i1616to32(b[l++],b[l++])),e.push(y),e.push(k),e.push(d.i1616to32(p[0],p[1])),e.push(d.i1616to32(h[0],h[1])),e.push(a),v&&(e.push(x),e.push(q));for(b=0;b<g;)t.push(u[b++]+c),t.push(u[b++]+c),t.push(u[b++]+c);c+=f.coordCount/2}G.release(m);B.update({geometry:e},c,t);return B;case F.WGLGeometryType.LINE:return L.createLineMeshData(m,
k,v,q,y,r,x,p,a)}return null}});