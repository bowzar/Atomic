// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../AnimationController ../../../webgl-engine/lib/Camera ../../../lib/glMatrix ../../utils/navigationUtils ../../../../navigation/Momentum ../../utils/navigationUtils ../../../camera/constraintUtils".split(" "),function(l,m,q,r,n,b,f,h,p,g){Object.defineProperty(m,"__esModule",{value:!0});var t=b.vec3d.create();l=function(k){function c(e){var a=k.call(this)||this;a.view=e;a.zoom={momentum:null,estimator:new h.ZoomMomentumEstimator(.05),
enabled:!0};a.rotation={momentum:null,estimator:new h.RotationMomentumEstimator(.05,3,.05,.95),enabled:!0};a.pan={momentum:null,estimator:new h.ScreenspaceMomentumEstimator(.05,500,12,.82),enabled:!0};a.elapsedTimeSec=0;a._panAxisOrDirection=b.vec3d.create();a._centerOnScreen=b.vec2d.create();a._centerOnSphere=b.vec3d.create();a._tmpSphereCenter=b.vec3d.create();a._tmpScaleAxis=b.vec3d.create();a.sphere={center:b.vec3d.create(),radius:0};a.tmpInteractionDirection=b.vec3d.create();a._verticalCenter=
b.vec3d.create();a.beginCamera=new n;a.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new n,interactionDirection:null};return a}q(c,k);c.prototype.setParameters=function(e,a,d,c){this.sphere.radius=e;d&&c?(b.vec2d.set(d,this._centerOnScreen),b.vec3d.set(c,this._centerOnSphere)):(this.zoom.enabled=!1,this.rotation.enabled=!1);this._mode=a};c.prototype.setParametersVertical=function(e){b.vec3d.set(e,this._verticalCenter)};c.prototype.addPanValue=function(e,
a,d,c){this.pan.estimator.add(a[0],a[1],d,.001*e);b.vec3d.set(c,this._panAxisOrDirection)};c.prototype.addRotationValue=function(b,a){this.rotation.estimator.add(a,.001*b)};c.prototype.addScaleValue=function(b,a){this.zoom.estimator.add(a,.001*b)};c.prototype.initiate=function(){this.zoom.enabled&&(this.zoom.momentum=this.zoom.estimator.evaluateMomentum());!this.zoom.momentum&&this.rotation.enabled&&(this.rotation.momentum=this.rotation.estimator.evaluateMomentum());this.zoom.momentum||this.rotation.momentum||
!this.pan.enabled||(this.pan.momentum=this.pan.estimator.evaluateMomentum());return null!=(this.zoom.momentum||this.rotation.momentum||this.pan.momentum)};c.prototype.onControllerStart=function(b){this.beginCamera.copyFrom(b);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera);k.prototype.onControllerStart.call(this,b)};Object.defineProperty(c.prototype,"steppingFinished",{get:function(){return this.momentumFinished()},enumerable:!0,configurable:!0});c.prototype.stepController=
function(c,a){a.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=c;var d=this._centerOnScreen;c=this._centerOnSphere;if(this.zoom.momentum){var e=this.zoom.momentum.valueDelta(0,this.elapsedTimeSec);this._mode===p.PanMode.Horizontal?(f.applyZoomOnSphere(this.sphere,a,e),this.constraintOptions.selection=15,this.constraintOptions.interactionType=1,this.constraintOptions.interactionDirection=null,g.applyAll(this.view,a,this.constraintOptions),f.sphereOrSilhouettePointFromScreenPoint(this.sphere,a,
d,this._tmpSphereCenter),d=f.rotationAndAxisFromPoints(c,this._tmpSphereCenter,this._tmpScaleAxis),f.applyRotation(a,this.sphere.center,this._tmpScaleAxis,d),this.constraintOptions.interactionType=4):(b.vec3d.set(a.eye,this.tmpInteractionDirection),f.applyZoomToPoint(a,this._verticalCenter,e,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=1,this.constraintOptions.interactionDirection=b.vec3d.direction(this.tmpInteractionDirection,a.eye));g.applyAll(this.view,
a,this.constraintOptions)}this.pan.momentum&&(this._mode===p.PanMode.Horizontal?(d=f.rotationAndAxisFromPoints(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest,this._panAxisOrDirection)/this.pan.momentum.dataTimeDelta,d=this.pan.momentum.valueFromInitialVelocity(d,this.elapsedTimeSec),f.applyRotation(a,this.sphere.center,this._panAxisOrDirection,d)):(d=b.vec3d.dist(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest),d/=this.pan.momentum.dataTimeDelta,d=this.pan.momentum.valueFromInitialVelocity(d,
this.elapsedTimeSec),b.vec3d.normalize(this._panAxisOrDirection),b.vec3d.scale(this._panAxisOrDirection,d),b.vec3d.subtract(a.eye,this._panAxisOrDirection),b.vec3d.subtract(a.center,this._panAxisOrDirection),a.markViewDirty(),this.constraintOptions.interactionDirection=this._panAxisOrDirection),this.constraintOptions.interactionType=4,g.applyAll(this.view,a,this.constraintOptions),this.constraintOptions.interactionDirection=null);this.rotation.momentum&&(d=this.rotation.momentum.valueDelta(0,this.elapsedTimeSec),
f.applyRotation(a,t,c,d),this.constraintOptions.interactionType=2,this.constraintOptions.interactionDirection=null,g.applyAll(this.view,a,this.constraintOptions))};c.prototype.momentumFinished=function(){this.zoom.momentum&&this.zoom.momentum.isFinished(this.elapsedTimeSec)&&(this.zoom.momentum=null);this.rotation.momentum&&this.rotation.momentum.isFinished(this.elapsedTimeSec)&&(this.rotation.momentum=null);this.pan.momentum&&this.pan.momentum.isFinished(this.elapsedTimeSec)&&(this.pan.momentum=
null);return!this.zoom.momentum&&!this.rotation.momentum&&!this.pan.momentum};return c}(r.AnimationController);m.MomentumController=l});