// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["require","exports","../../lib/glMatrix","./primitiveIntersectionUtils","../../support/mathUtils"],function(H,e,a,l,u){function v(b,a,d,g,f){void 0===f&&(f=!1);var c=q;l.createRay(a,d,c,f);return l.intersectSphere(b,c,g)?!0:(w(b,c,g),!1)}function r(a,c,d,g){var b=q;l.createRay(c,d,b,!0);return l.intersectSphere(a,b,g)}function x(b,c,d){a.vec3d.cross(b,c,d);b=a.vec3d.dot(b,c)/(a.vec3d.length(b)*a.vec3d.length(c));return-u.acos(b)}function y(b,c,d,g){var f=E;a.mat4d.identity(f);a.mat4d.rotate(f,
g,d);a.vec3d.subtract(b.eye,c);a.mat4d.multiplyVec3(f,b.eye,b.eye);a.vec3d.add(b.eye,c);a.vec3d.subtract(b.center,c);a.mat4d.multiplyVec3(f,b.center,b.center);a.vec3d.add(b.center,c);a.mat4d.multiplyVec3(f,b.up,b.up);b.markViewDirty()}function w(b,c,d){var g=z,f=A,e=F;a.vec3d.subtract(c.origin,b.center,f);a.vec3d.cross(f,c.direction,g);a.vec3d.cross(g,f,d);a.vec3d.scale(d,1/a.vec3d.length(d)*b.radius);b=-u.asin(b.radius/a.vec3d.length(c.origin));a.mat4d.identity(e);a.mat4d.rotate(e,b,g);a.mat4d.multiplyVec3(e,
d)}function B(b,c){a.vec3d.set3(0,0,0,c);for(var d=0;d<b.length;d++)a.vec3d.add(c,b[d]);a.vec3d.scale(c,1/b.length)}Object.defineProperty(e,"__esModule",{value:!0});e.Earth={center:a.vec3d.create(),radius:6378137};e.normalizeCoordinate=function(a,c,d){d[0]=c[0]/a.width;d[1]=c[1]/a.height;return d};e.sphereOrSilhouettePointFromScreenPoint=v;e.intersectSphereFromScreenPoint=r;e.rotationAndAxisFromPoints=x;e.rotationFromPointsAroundAxis=function(b,c,d){var e=z,f=A,h=G;a.vec3d.set(b,f);a.vec3d.set(c,
h);b=a.vec3d.dot(f,d);c=a.vec3d.dot(h,d);a.vec3d.scale(d,b,e);a.vec3d.subtract(f,e);a.vec3d.normalize(f);a.vec3d.scale(d,c,e);a.vec3d.subtract(h,e);a.vec3d.normalize(h);b=a.vec3d.dot(f,h);a.vec3d.cross(d,f,e);d=a.vec3d.dot(h,e);return Math.atan2(d,b)};e.setPlane=function(b,c,d){a.vec3d.set(c,d.normal);d.d=-a.vec3d.dot(c,b)};e.setPlaneD=function(b,c){c.d=-a.vec3d.dot(c.normal,b)};e.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};e.applyRotation=
y;e.closestPointOnSphereSilhouette=w;e.intersectPlaneFromScreenPoint=function(a,c,d,e){var b=q;l.createRay(c,d,b);return l.intersectPlane(a,b,e)};e.applyZoomToPoint=function(b,c,d,e){var f=m;d=1-d;a.vec3d.subtract(c,b.eye,f);var g=a.vec3d.length(f),k=g*(1-d);0<=d&&k<e&&(k=e,d=-(k-g)/g);1E-6>Math.abs(g-k)||(a.vec3d.scale(f,d),a.vec3d.add(b.eye,f),a.vec3d.lerp(b.center,c,d))};e.applyZoomOnSphere=function(b,c,d){a.vec2d.set2(c.width/2,c.height/2,C);r(b,c,C,c.center);a.vec3d.subtract(c.center,c.eye,m);
b=a.vec3d.length(m);1E-6>Math.abs(b-b*d)||(a.vec3d.scale(m,d),a.vec3d.subtract(c.center,m,c.eye),c.markViewDirty())};var C=a.vec2d.create();e.navPointToScreenPoint=function(b,c,d){a.vec2d.set2(c.x,b.height-c.y,d)};e.centroidOnSphere=function(b,c,d){B(c,d);a.vec3d.normalize(d);a.vec3d.scale(d,b)};e.centroid=B;var n;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(n=e.PanMode||(e.PanMode={}));e.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};e.pickPointAndInitSphere=
function(b,c,d,g){var f=a.vec3d.create(),h={center:a.vec3d.create(),radius:0},k=!0;b.pickPointInScreen(d,f)?h.radius=a.vec3d.length(f):(h.radius=a.vec3d.length(c.center),h.radius<.9*e.Earth.radius&&(h.radius=e.Earth.radius),h.radius=Math.max(a.vec3d.length(c.center),.9*e.Earth.radius),g?v(h,c,d,f):k=r(h,c,d,f));return{sphere:h,scenePickPoint:k?f:null}};e.decidePanMode=function(b,c,d){if(a.vec3d.length(b.eye)-e.Earth.radius<e.VerticalPanTresholds.Elevation){if(c.radius>a.vec3d.length(b.eye))return n.Vertical;
a.vec3d.normalize(a.vec3d.subtract(b.eye,d,D));return Math.abs(.5*Math.PI-Math.acos(a.vec3d.dot(d,D)/a.vec3d.length(d)))<e.VerticalPanTresholds.Angle?n.Vertical:n.Horizontal}return n.Horizontal};var D=a.vec3d.create();e.applyPanPlanar=function(b,c,d,e){a.vec3d.subtract(d,c,p);a.vec3d.subtract(b.eye,p);a.vec3d.subtract(b.center,p);b.markViewDirty();e&&e.estimator.addPanValue(e.time,e.endScreenPoint,d,p)};var p=a.vec3d.create();e.applyPanSpherical=function(a,c,d,e,f){d=x(d,e,t);y(c,a.center,t,d);f&&
f.estimator.addPanValue(f.time,f.endScreenPoint,e,t)};var t=a.vec3d.create(),F=a.mat4d.create(),E=a.mat4d.create(),m=a.vec3d.create(),z=a.vec3d.create(),A=a.vec3d.create(),G=a.vec3d.create(),q={origin:a.vec3d.create(),direction:a.vec3d.create()}});