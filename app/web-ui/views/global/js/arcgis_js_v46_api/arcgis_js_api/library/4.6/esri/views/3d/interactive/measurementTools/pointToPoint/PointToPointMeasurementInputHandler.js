// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/HandleRegistry ../../../../../geometry/ScreenPoint ../../../../input/InputHandler ../support/inputUtils".split(" "),function(n,p,h,k,l,m,g){function e(e){return"mouse"===e.native.pointerType}return function(f){function d(a,b){var c=f.call(this,!0)||this;c._dragHandle=null;c._viewEventHandles=new k;c._tool=a;c._controller=b;c.registerIncoming("first-click",function(a){return c._handleFirstClick(a)});c.registerIncoming("click",
function(a){return c._handleClick(a)});c.registerIncoming("double-click",function(a){return c._handleDoubleClick(a)});c.registerIncoming("drag",function(a){return c._handleDrag(a)});c.registerIncoming("pointer-move",function(a){return c._handlePointerMove(a)});c.registerIncoming("key-down",function(a){return c._handleKeyDown(a)});return c}h(d,f);d.prototype.onInstall=function(a){f.prototype.onInstall.call(this,a);a=this._tool.view;for(var b=0,c=["click","double-click","drag"];b<c.length;b++)this._viewEventHandles.add(a.on(c[b],
function(){}))};d.prototype.onUninstall=function(){f.prototype.onUninstall.call(this);this._viewEventHandles.removeAll()};d.prototype._handleDrag=function(a){var b=a.data.pointers[0].currentEvent,b=new l([b.x,b.y]);e(a.data.pointers[0].startEvent)&&0!==a.data.pointers[0].startEvent.native.button||("start"===a.data.action?"measured"===this._controller.model.state&&(this._dragHandle=this._controller.handleAt(b))&&(this._controller.model.state="editing",this._controller.model.draggedHandles.add(this._dragHandle),
a.stopPropagation()):"update"===a.data.action?null!==this._dragHandle&&(this._controller.moveHandleTo(this._dragHandle,b),a.stopPropagation()):"end"===a.data.action&&null!==this._dragHandle&&(a.stopPropagation(),this._controller.model.draggedHandles.remove(this._dragHandle),this._dragHandle=null,this._controller.model.finishedMeasurement({cameraAboveGround:this._controller.view.cameraAboveGround}),e(a.data.pointers[0].startEvent)||(this._controller.model.hoveredHandle=null)))};d.prototype._handlePointerMove=
function(a){var b=g.screenPointFromEvent(a);e(a.data)&&(this._controller.hoverAt(b),"drawing"===this._controller.model.state&&(this._controller.endAt(b),a.stopPropagation()))};d.prototype._handleFirstClick=function(a){var b=g.screenPointFromEvent(a);if(!e(a.data)||0===a.data.native.button){switch(this._controller.model.state){case "initial":if(this._controller.startAt(g.screenPointFromEvent(a),a.data.native.pointerType)){this._controller.model.state="drawing";a.stopPropagation();return}break;case "drawing":if(this._controller.endAt(b,
a.data.native.pointerType)){this._controller.model.finishedMeasurement({cameraAboveGround:this._controller.view.cameraAboveGround});a.stopPropagation();return}break;case "measured":if(null===this._controller.handleAt(b)&&(this._controller.clearMeasurement(),this._controller.startAt(b,a.data.native.pointerType))){this._controller.model.state="drawing";a.stopPropagation();return}}e(a.data)&&this._controller.hoverAt(b)}};d.prototype._handleClick=function(a){e(a.data)&&0!==a.data.native.button||a.stopPropagation()};
d.prototype._handleDoubleClick=function(a){e(a.data)&&0!==a.data.native.button||a.stopPropagation()};d.prototype._handleKeyDown=function(a){var b=this._controller.model.state;"Escape"===a.data.key&&"drawing"===b&&(this._controller.clearMeasurement(),a.stopPropagation())};return d}(m.InputHandler)});