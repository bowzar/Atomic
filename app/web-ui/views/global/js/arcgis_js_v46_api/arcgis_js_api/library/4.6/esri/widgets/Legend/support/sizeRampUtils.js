// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../symbols/support/symbolUtils","../../../core/numberUtils","./utils"],function(K,p,u,q,B){function C(a,b){var c=null,d=null;if("simple"===a.type)c=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)c=(c=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&c.symbol,d=1<a.length;if(!c||D(c))return null;c=c.clone();if(b||d)-1<c.type.indexOf("3d")?E(c):(b=c,-1!==b.type.indexOf("line")?b.color=t:(b.color=w,"simple-marker"===b.type&&(b.outline={color:t,width:1.5})));
return c}function D(a){if(a)return-1<a.type.indexOf("3d")?(a=a.symbolLayers)?a.some(function(a){return a&&"fill"===a.type}):!1:-1!==a.type.indexOf("fill")}function E(a){u.isVolumetricSymbol(a)||(-1!==a.type.indexOf("line-3d")?a.symbolLayers.forEach(function(a){a.material={color:t}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:F}:(a.material={color:w},a.outline={color:t,size:1.5})}))}function G(a,b,c,d){var e=a.getSizeRangeAtScale(b,d),g=e&&H(e);
if(e||g){for(var h=g.map(function(a){var c=e.minSize,d=e.maxSize,f=b.minDataValue,g=b.maxDataValue;return a<=c?f:a>=d?g:(a-c)/(d-c)*(g-f)+f}),h=q.round(h),f=1;f<h.length-1;f++){var m=I(a,b,c,h[f],h[f-1],d);m&&(h[f]=m[0],g[f]=m[1])}return h}}function H(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var c=[],d=0;5>d;d++)c.push(b+a*d);return c}function I(a,b,c,d,e,g){var h=v(a,b,c,d,g);e=v(a,b,c,e,g);var f=q.numDigits(d),m=f.fractional,n=f.integer,k=f=null;0<d&&1>d&&(f=Math.pow(10,m),d*=f,n=q.numDigits(d).integer);
for(m=n-1;0<=m;m--){var l=Math.pow(10,m),n=Math.floor(d/l)*l,l=Math.ceil(d/l)*l;null!=f&&(n/=f,l/=f);var r=(n+l)/2,r=q.round([n,r,l],{indexes:[1]}),r=r[1],z=v(a,b,c,n,g),A=v(a,b,c,l,g),p=v(a,b,c,r,g),t=q.percentChange(h,z,e,null),u=q.percentChange(h,A,e,null),w=q.percentChange(h,p,e,null),x=20>=t.previous,y=20>=u.previous;x&&y&&(t.previous<=u.previous?(x=!0,y=!1):(y=!0,x=!1));x?k=[n,z]:y?k=[l,A]:20>=w.previous&&(k=[r,p]);if(k)break}return k}function v(a,b,c,d,e){return a.getSize(d,{sizeInfo:b,scale:e,
shape:-1!==c.type.indexOf("marker-symbol")?c.style:null})}function J(a,b){a=a.clone();if("esri.symbols.Symbol3D"===a.declaredClass)u.isVolumetricSymbol(a)||a.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=b)});else if("esri.symbols.SimpleMarkerSymbol"===a.declaredClass)a.size=b;else if("esri.symbols.PictureMarkerSymbol"===a.declaredClass){var c=a.width,d=a.height;a.height=b;a.width=c/d*b}else"esri.symbols.SimpleLineSymbol"===a.declaredClass?a.width=b:"esri.symbols.TextSymbol"===a.declaredClass&&
a.font&&(a.font.size=b);return a}Object.defineProperty(p,"__esModule",{value:!0});p.REAL_WORLD_MAX_SIZE=30;p.REAL_WORLD_MIN_SIZE=12;var w=[255,255,255],F=[200,200,200],t=[128,128,128];p.getRampStops=function(a,b,c,d){var e=b.legendOptions,e=e&&e.customValues,g=C(a,c);c=null!=b.minSize&&null!=b.maxSize;var h=b.stops&&1<b.stops.length,f=!!b.target;if(g&&(e||c||h&&!f)){var m=u.isVolumetricSymbol(g),n=null,k=null,l=null,k=m&&!h?[b.minDataValue,b.maxDataValue]:e||G(a,b,g,d);!k&&h&&(k=b.stops.map(function(a){return a.value}),
(n=b.stops.some(function(a){return!!a.label}))&&(l=b.stops.map(function(a){return a.label})));e=!m||k&&2===k.length;if(!k||!e)return null;var r=[p.REAL_WORLD_MIN_SIZE,p.REAL_WORLD_MAX_SIZE];return k.map(function(c,e){var f=m?r[e]:v(a,b,g,c,d),h=J(g,f);e=n?l[e]:B.getLabelPrefix(e,k.length-1)+q.format(c);return{value:c,symbol:h,label:e,size:f}}).reverse()}}});