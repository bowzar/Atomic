// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../core/tsSupport/assignHelper ../../../../support/arcadeUtils ../../../../arcade/Feature ./visualVariablesUtils".split(" "),function(t,c,n,h,p,r){function q(a,b){if(!a)return null;var m=0,l={};a=a.clone();var f=a.valueExpression,g=a.visualVariables,d=null;if(!a.field&&f){e||(e=new p(null));var k="$$fake"+m++,c=h.createFunction(f);l[k]=function(a,d){e.attributes=a.attributes;return h.executeFunction(c,{vars:{$feature:e,$view:h.getViewInfo(d)},spatialReference:b})};
a.field=k;a.valueExpression=null;d=function(a,b){b.attributes[k]=l[k](b);return a.getSymbol(b)}}g&&(a.visualVariables=g.map(function(a){if(a.normalizationField){var d=a.field,k=a.normalizationField,c="$$fake"+m++;l[c]=function(a,b){return a.attributes[d]/a.attributes[k]};a=n({},a);a.field=c;delete a.normalizationField;return a}if(a.valueExpression&&"$view.scale"!==a.valueExpression){var f=a.valueExpression,c="$$fake"+m++,g=h.createFunction(f);e||(e=new p(null));l[c]=function(a,d){e.attributes=a.attributes;
return h.executeFunction(g,{vars:{$feature:e,$view:h.getViewInfo(d)},spatialReference:b})};a=n({},a);a.field=c;delete a.valueExpression}return a}));return{renderer:a,normalizingFunctions:l,getSymbolFunction:d}}Object.defineProperty(c,"__esModule",{value:!0});var e;c.createRendererInfo=function(a,b){var c=(b=q(a,b)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},b.normalizingFunctions),e=b&&b.getSymbolFunction;a=b&&b.renderer||a;b=null;if("heatmap"===a.type){var f=a.offset;b=9*Math.round(a.blurRadius)+
1;b={getIntensity:function(a){return"function"===typeof a?a:a?"abs"===f?function(b){return Math.abs(b.attributes[a])}:function(b){return b.attributes[a]+f}:function(a){return 1}}(a.field),kernelSize:b,radius:a.blurRadius}}var g=r.convertVisualVariables(a.visualVariables);return{renderer:a,vvFields:g.vvFields,vvRanges:g.vvRanges,heatmapInfo:b,getValue:function(a,b){var d=c[b];return d?d(a):a.attributes[b]},getSymbol:function(a){return e?e(this.renderer,a):this.renderer.getSymbol?this.renderer.getSymbol(a):
null}}};c.getNormalizedRenderer=function(a,b){return(b=q(a,b)||{renderer:null,normalizingFunctions:null,getSymbolFunction:null},b.renderer)||a};c.getSymbol=function(a,b){return a.getSymbol(b)}});