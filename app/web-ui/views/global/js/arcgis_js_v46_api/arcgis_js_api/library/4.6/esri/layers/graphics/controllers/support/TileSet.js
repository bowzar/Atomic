// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../geometry/Extent","../../../../tasks/support/QuantizationParameters"],function(l,m,h,e){return function(){function b(a){this.layer=a.layer;this.tileInfo=a.tileInfo}b.prototype.fetch=function(a){return this._queryTile(a)};b.prototype._queryTile=function(a){return this.layer.queryFeatures(this._createQuery(a))};b.prototype._createQuery=function(a){this.tileInfo.updateTileInfo(a);var g=this.tileInfo.spatialReference,c=a.extent,b=c[0],e=c[1],k=c[2],c=c[3],d=this.layer.createQuery();
d.geometry=new h({xmin:b,ymin:e,xmax:k,ymax:c,spatialReference:g});d.outSpatialReference=g;this._setResolutionParams(d,a);return d};b.prototype._setResolutionParams=function(a,b){var c=this.layer,f=c.geometryType;if("polyline"===f||"polygon"===f)b=this.tileInfo.lodAt(b.level).resolution,"polyline"===f&&(a.maxAllowableOffset=b),c.get("capabilities.query.supportsQuantization")&&(a.quantizationParameters=new e({mode:"view",originPosition:"upper-left",tolerance:b,extent:c.fullExtent}))};return b}()});