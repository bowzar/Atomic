// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/has ../../../core/accessorSupport/decorators ../../../core/Collection ../../../core/Error ../../../core/HandleRegistry ../../../core/promiseUtils ../../../core/requireUtils ../../../Graphic ../../../layers/graphics/QueryEngine ./LayerView2D ../../layers/RefreshableLayerView ./support/FeaturesView2D ../engine/DOMContainer".split(" "),function(n,B,p,g,k,f,q,r,t,l,u,v,w,x,y,z,A){function h(e){return e&&
e.update}return function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a._handles=new t;a.container=new A;return a}p(b,e);b.prototype.highlight=function(a,b){var m=this;b=this.featuresView;var d;a instanceof v?d=[a.getAttribute(this.layer.objectIdField)]:"number"===typeof a?d=[a]:q.isCollection(a)?d=a.map(function(a){return a.getAttribute(m.layer.objectIdField)}).toArray():Array.isArray(a)&&0<a.length&&(d="number"===typeof a[0]?a:a.map(function(a){return a.getAttribute(m.layer.objectIdField)}));
return d&&d.length&&b&&b.highlight?b.highlight(d):{remove:function(){}}};b.prototype.queryGraphics=function(){return this._queryEngine?this._queryEngine.queryFeatures():this._rejectQuery()};b.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};b.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};b.prototype.queryFeatureCount=function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):
this._rejectQuery()};b.prototype.queryExtent=function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};b.prototype.hitTest=function(a,b){return this.suspended||!this.featuresView?l.resolve():this.featuresView.hitTest(a,b)};b.prototype.update=function(a){h(this.controller)?this.controller.update(a):h(this.featuresView)&&this.featuresView.update(a)};b.prototype.attach=function(){var a=this;this._canUseWebGL()?u.when(n,["./support/FeatureLayerView2DWebGL"]).then(function(b){if(a.attached)return(new b[0]({layer:a.layer,
view:a.view})).when()}).then(function(b){a.featuresView=b;a.container.addChild(b.container);b.attached=!0;b.attach()}):this.layer.createGraphicsController({layerView:this}).then(function(b){if(a.attached){a._set("controller",b);a.requestUpdate();var c=new z;c.mapView=a.view;c.graphics=b.graphics;c.layer=a.layer;c.renderer=a.layer.renderer;a.featuresView=c;a._handles.add(a.layer.watch("renderer",function(){c.renderer=a.layer.renderer}));a._queryEngine=new w;a._queryEngine.features=b.graphics;a._queryEngine.objectIdField=
a.layer.objectIdField;a.container.addChild(c.container)}})};b.prototype.detach=function(){this.container.removeAllChildren();this._handles.removeAll();this.featuresView&&(this.featuresView.destroy(),this.featuresView=null);this.controller&&(this.controller.destroy&&this.controller.destroy(),this._set("controller",null))};b.prototype.moveStart=function(){this.requestUpdate()};b.prototype.viewChange=function(){this.requestUpdate()};b.prototype.moveEnd=function(){this.requestUpdate()};b.prototype.doRefresh=
function(){if(!this.updateRequested&&!this.suspended){var a;if(a=this.controller)a=(a=this.controller.activeController)&&a.refresh;a&&this.controller.activeController.refresh()}};b.prototype.isUpdating=function(){return null==this.featuresView||!0===this.get("controller.updating")||this.featuresView.updateRequested||h(this.featuresView)&&this.featuresView.isUpdating()};b.prototype._canUseWebGL=function(){return k("esri-featurelayer-webgl")&&k("esri-webgl")&&this._isRendererWebGLCompatible()&&(this.layer.capabilities.query.supportsQuantization&&
("polygon"!==this.layer.geometryType||this.layer.capabilities.query.supportsCentroid)||this.layer.source&&"esri.layers.graphics.sources.CSVSource"===this.layer.source.declaredClass)};b.prototype._isRendererWebGLCompatible=function(){var a=this.layer.renderer;return a&&-1!==["simple","class-breaks","unique-value"].indexOf(a.type)?!0:!1};b.prototype._rejectQuery=function(){return l.reject(new r("FeatureLayerView2D","Not ready to execute query"))};g([f.property({readOnly:!0})],b.prototype,"controller",
void 0);g([f.property()],b.prototype,"featuresView",void 0);g([f.property({dependsOn:["controller.updating","featuresView","featuresView.updating"]})],b.prototype,"updating",void 0);return b=g([f.subclass("esri.views.2d.layers.FeatureLayerView2D")],b)}(f.declared(x,y))});