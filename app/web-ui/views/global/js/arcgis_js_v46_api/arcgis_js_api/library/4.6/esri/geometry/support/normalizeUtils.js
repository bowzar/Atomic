// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../config ../../tasks/GeometryService ../Polygon ../Polyline ../SpatialReference ./webMercatorUtils ./spatialReferenceUtils".split(" "),function(Q,y,J,K,L,M,N,A,v,C,z,D){function p(a){return"polygon"===a.type?a.rings:a.paths}function q(a,b){return Math.ceil((a-b)/(2*b))}function E(a,b){for(var c=p(a),d=0;d<c.length;d++)for(var f=c[d],e=0;e<f.length;e++){var g=a.getPoint(d,e);a.setPoint(d,e,g.clone().offset(b,0))}return a}
function F(a){for(var b=[],c=0,d=0,f=0;f<a.length;f++){for(var e=a[f],g=null,h=0;h<e.length;h++)g=e[h],b.push(g),0===h?d=c=g[0]:(c=Math.min(c,g[0]),d=Math.max(d,g[0]));g&&b.push([(c+d)/2,0])}return b}function G(a,b){if(!(a instanceof v||a instanceof A))throw O.error("straightLineDensify: the input geometry is neither polyline nor polygon"),new J("straightLineDensify: the input geometry is neither polyline nor polygon");for(var c=[],d=0,f=p(a);d<f.length;d++){var e=f[d],g=[];c.push(g);g.push([e[0][0],
e[0][1]]);for(var h=0;h<e.length-1;h++){var l=e[h][0],r=e[h][1],m=e[h+1][0],n=e[h+1][1],k=Math.sqrt((m-l)*(m-l)+(n-r)*(n-r)),q=(n-r)/k,t=(m-l)/k,w=k/b;if(1<w){for(var u=1;u<=w-1;u++){var x=u*b;g.push([t*x+l,q*x+r])}k=(k+Math.floor(w-1)*b)/2;g.push([t*k+l,q*k+r])}g.push([m,n])}}return"polygon"===a.type?new A({rings:c,spatialReference:a.spatialReference}):new v({paths:c,spatialReference:a.spatialReference})}function H(a,b,c){b&&(a=G(a,1E6),a=z.webMercatorToGeographic(a,!0));c&&(a=E(a,c));return a}function I(a,
b,c){if(Array.isArray(a)){var d=a[0];if(d>b){var f=q(d,b);a[0]=d+-2*f*b}else d<c&&(f=q(d,c),a[0]=d+-2*f*c)}else d=a.x,d>b?(f=q(d,b),a=a.clone().offset(-2*f*b,0)):d<c&&(f=q(d,c),a=a.clone().offset(-2*f*c,0));return a}function P(a,b){var c=-1;b.cutIndexes.forEach(function(d,f){var e=b.geometries[f];p(e).forEach(function(a,d){a.some(function(c){if(!(180>c[0])){for(var b=c=0;b<a.length;b++){var f=a[b][0];c=f>c?f:c}c=Number(c.toFixed(9));c=-360*q(c,180);for(b=0;b<a.length;b++)f=e.getPoint(d,b),e.setPoint(d,
b,f.clone().offset(c,0))}return!0})});if(d===c)if("polygon"===a[0].type){f=0;for(var g=p(e);f<g.length;f++)a[d]=a[d].addRing(g[f])}else{if("polyline"===a[0].type)for(f=0,g=p(e);f<g.length;f++)a[d]=a[d].addPath(g[f])}else c=d,a[d]=e});return a}Object.defineProperty(y,"__esModule",{value:!0});var O=K.getLogger("esri.geometry.support.normalizeUtils");y.straightLineDensify=G;var B;y.normalizeCentralMeridian=function(a,b){b||(B||(B=new N({url:M.geometryServiceUrl})),b=B);for(var c,d,f,e,g,h,l,r,m=0,n=
[],k=a.map(function(a){if(!a)return a;c||(c=a.spatialReference,d=D.getInfo(c),e=(f=c.isWebMercator)?2.0037508342788905E7:180,g=f?-2.0037508342788905E7:-180,h=f?102100:4326,l=new v({paths:[[[e,g],[e,e]]],spatialReference:new C({wkid:h})}),r=new v({paths:[[[g,g],[g,e]]],spatialReference:new C({wkid:h})}));if(!d)return a;if("point"===a.type)return I(a.clone(),e,g);if("multipoint"===a.type){var b=a.clone();b.points=b.points.map(function(a){return I(a,e,g)});return b}if("extent"===a.type)return b=a.clone(),
b=b._normalize(!1,!1,d),b.rings?new A(b):b;if(a.extent){var b=a.extent,k=2*q(b.xmin,g)*e;a=0===k?a.clone():E(a.clone(),k);b.offset(k,0);return b.intersects(l)&&b.xmax!==e?(m=b.xmax>m?b.xmax:m,a=H(a,f),n.push(a),"cut"):b.intersects(r)&&b.xmin!==g?(m=2*b.xmax*e>m?2*b.xmax*e:m,a=H(a,f,360),n.push(a),"cut"):a}return a.clone()}),p=q(m,e),t=-90,w=p,u=new v;0<p;){var x=-180+360*p;u.addPath([[x,t],[x,-1*t]]);t*=-1;p--}return 0<n.length&&0<w?b.cut(n,u).then(function(a){return P(n,a)}).then(function(c){var d=
[],e=k.map(function(b,e){if("cut"!==b)return b;b=c.shift();e=a[e];return"polygon"===e.type&&e.rings&&1<e.rings.length&&b.rings.length>=e.rings.length?(d.push(b),"simplify"):f?z.geographicToWebMercator(b):b});return d.length?b.simplify(d).then(function(a){return e.map(function(b){return"simplify"!==b?b:f?z.geographicToWebMercator(a.shift()):a.shift()})}):k}):L.resolve(k.map(function(a){if("cut"!==a)return a;a=n.shift();return!0===f?z.geographicToWebMercator(a):a}))};y.getDenormalizedExtent=function(a){if(!a)return null;
var b=a.extent;if(!b)return null;var c=a.spatialReference&&D.getInfo(a.spatialReference);if(!c)return b;var c=c.valid,d=c[0],c=c[1],f=b.width,e=b.xmin,g=b.xmax,g=[g,e],e=g[0],g=g[1];if("extent"===a.type||0===f||f<=c||f>2*c||e<d||g>c)return b;var h;switch(a.type){case "polygon":if(1<a.rings.length)h=F(a.rings);else return b;break;case "polyline":if(1<a.paths.length)h=F(a.paths);else return b;break;case "multipoint":h=a.points}a=b.clone();for(d=0;d<h.length;d++){var l=h[d][0];0>l?(l+=c,g=Math.max(l,
g)):(l-=c,e=Math.min(l,e))}a.xmin=e;a.xmax=g;return a.width<f?(a.xmin-=c,a.xmax-=c,a):b}});