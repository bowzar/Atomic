// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../webgl/VertexArrayObject","../Utils"],function(t,u,h,m){return function(){function g(){this._isInitialized=!1;this._fillAttributeLocations={a_pos:0,a_id:1,a_color:2,a_tlbr:3,a_aux:4};this._fillAttributeLocationsVV={a_pos:0,a_id:1,a_color:2,a_tlbr:3,a_aux:4,a_vv:5};this._spritesTextureSize=new Float32Array(2)}g.prototype.draw=function(c,b,d,e,a,g,h,p,q,r,k,n){if(d.canDisplay){this._initialize();var l=b.materialKeyInfo,f=l.vvColor||l.vvOpacity;if(a=k.getProgram(b.materialKey,
a,f?this._fillAttributeLocationsVV:this._fillAttributeLocations))c.bindProgram(a),f=this._getVAO(c,d,f),c.bindVAO(f),0<b.texBindingInfo.length&&(b=b.texBindingInfo[0],f=b.pageId,k=n.sprites,this._spritesTextureSize[0]=k.getWidth(f),this._spritesTextureSize[1]=k.getHeight(f),a.setUniform1f("u_zoomFactor",d.coordRange/m.C_TILE_SIZE/Math.pow(2,g-d.key.level)/h),n.bindSpritePage(c,f,b.unit,p?9728:9729),a.setUniform1i(b.semantic,b.unit),a.setUniform2fv("u_mosaicSize",this._spritesTextureSize)),a.setUniformMatrix4fv("u_transformMatrix",
d.tileTransform.transform),a.setUniform2fv("u_normalized_origin",d.tileTransform.displayCoord),a.setUniform1f("u_opacity",1),l.vvColor&&(a.setUniform1fv("u_vvColorValues",e.vvColorValues),a.setUniform4fv("u_vvColors",e.vvColors)),l.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",e.vvOpacityValues),a.setUniform1fv("u_vvOpacities",e.vvOpacities)),c.drawElements(4,r,5125,4*q),c.bindVAO(null)}};g.prototype._initialize=function(){if(this._isInitialized)return!0;this._fillVertexAttributeLayout={geometry:[{name:"a_pos",
count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:24,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:24,normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_aux",count:4,type:5121,offset:20,stride:24,normalized:!1,divisor:0}]};this._fillVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:32,normalized:!1,divisor:0},{name:"a_id",
count:4,type:5121,offset:4,stride:32,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:32,normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:32,normalized:!1,divisor:0},{name:"a_aux",count:4,type:5121,offset:20,stride:32,normalized:!1,divisor:0},{name:"a_vv",count:2,type:5126,offset:24,stride:32,normalized:!1,divisor:0}]};this._isInitialized=!0};g.prototype._getVAO=function(c,b,d){if(b.fillGeometry.vao)return b.fillGeometry.vao;var e=b.fillGeometry.vertexBufferMap[m.C_VBO_GEOMETRY],
a=b.fillGeometry.indexBuffer;if(!e||!a)return null;b.fillGeometry.vao=d?new h(c,this._fillAttributeLocationsVV,this._fillVertexAttributeLayoutVV,{geometry:e},a):new h(c,this._fillAttributeLocations,this._fillVertexAttributeLayout,{geometry:e},a);return b.fillGeometry.vao};return g}()});