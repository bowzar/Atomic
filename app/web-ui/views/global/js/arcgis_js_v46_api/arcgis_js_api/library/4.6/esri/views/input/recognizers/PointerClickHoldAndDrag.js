// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(k,f,l,m,n){Object.defineProperty(f,"__esModule",{value:!0});f.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};k=function(h){function g(d,c,b,e){void 0===d&&(d=f.DefaultParameters.maximumClickDelay);void 0===c&&(c=f.DefaultParameters.movementUntilMouseDrag);void 0===b&&(b=f.DefaultParameters.movementUntilTouchDrag);void 0===e&&(e=f.DefaultParameters.holdDelay);
var a=h.call(this,!1)||this;a.maximumClickDelay=d;a.movementUntilMouseDrag=c;a.movementUntilTouchDrag=b;a.holdDelay=e;a._pointerState=new Map;a._modifiers=new Set;a._pointerDrag=a.registerOutgoing("pointer-drag");a._pointerClick=a.registerOutgoing("pointer-click");a._pointerHold=a.registerOutgoing("hold");a.registerIncoming("pointer-down",a._handlePointerDown.bind(a));a.registerIncoming("pointer-up",a._handlePointerUpOrLost.bind(a));a.registerIncoming("pointer-capture-lost",a._handlePointerUpOrLost.bind(a));
a._moveHandle=a.registerIncoming("pointer-move",a._handlePointerMove.bind(a));a._moveHandle.pause();return a}l(g,h);g.prototype.onUninstall=function(){this._pointerState.forEach(function(d){0!==d.holdTimeout&&(clearTimeout(d.holdTimeout),d.holdTimeout=0)});h.prototype.onUninstall.call(this)};g.prototype._handlePointerDown=function(d){var c=this,b=d.data,e=b.native.pointerId,a=0;0===this._pointerState.size&&(a=setTimeout(function(){var a=c._pointerState.get(e);a&&(a.isDragging||(c._pointerHold.emit(a.previousEvent,
void 0,d.modifiers),a.holdEmitted=!0),a.holdTimeout=0)},this.holdDelay));1===this._pointerState.size&&this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});this._pointerState.set(e,{startEvent:b,previousEvent:b,startTimestamp:d.timestamp,isDragging:!1,downButton:b.native.button,holdTimeout:a});this.startCapturingPointer(b.native);this._moveHandle.resume()};g.prototype._createPointerDragData=function(d,c,b){return{action:d,startEvent:c.startEvent,
previousEvent:c.previousEvent,currentEvent:b}};g.prototype._handlePointerMove=function(d){var c=d.data,b=this._pointerState.get(c.native.pointerId);b&&(b.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",b,c),void 0,this._modifiers):n.euclideanDistance(c,b.startEvent)>("touch"===c.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&(b.isDragging=!0,b.previousEvent=b.startEvent,this._modifiers=d.modifiers,0!==b.holdTimeout&&clearTimeout(b.holdTimeout),
this._pointerDrag.emit(this._createPointerDragData("start",b,b.startEvent),b.startTimestamp),this._pointerDrag.emit(this._createPointerDragData("update",b,c))),b.previousEvent=c)};g.prototype._handlePointerUpOrLost=function(d){var c=d.data,b=c.native.pointerId,e=this._pointerState.get(b);e&&(0!==e.holdTimeout&&clearTimeout(e.holdTimeout),e.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",e,c),void 0,this._modifiers):e.downButton===c.native.button&&d.timestamp-e.startTimestamp<=
this.maximumClickDelay&&!e.holdEmitted&&this._pointerClick.emit(c),this._pointerState.delete(b),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return g}(m.InputHandler);f.PointerClickHoldAndDrag=k});