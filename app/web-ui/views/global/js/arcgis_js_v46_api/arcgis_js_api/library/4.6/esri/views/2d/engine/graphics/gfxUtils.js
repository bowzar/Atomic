// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports dojo/_base/lang ../../libs/gl-matrix/mat2d ../../libs/gl-matrix/mat2dExtras ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../symbols/SimpleMarkerSymbol ../../../../symbols/support/gfxUtils ../../../../Color".split(" "),function(P,k,B,x,y,u,K,r,v,L){function w(c,a){a.toRgba?(c[0]=a.r,c[1]=a.g,c[2]=a.b,c[3]=a.a):(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]);return c}function z(c,a,b){null!=b&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=b);return c}function C(c,a,b){var e=
a[0]/a[1];c[0]=c[1]=1;isNaN(b)||(1<e?(c[0]=b/a[0],c[1]=b/e/a[1]):(c[1]=b/a[1],c[0]=b*e/a[0]));return c}function D(c,a,b,e,f,h,g){var d=f.symbol;b=c.toScreenPoint(M,b,g[0]);g=[b.x,b.y];c=b.x;b=b.y;var k=f.heading,n=f.size&&f.size[0],l,m;x.identity(q);"number"===typeof n&&(m=isFinite(n)&&n);m=(n=m&&isFinite(m)&&!isNaN(m))?u.pt2px(m):NaN;h&&y.rotategAt(q,q,h,g);k&&y.rotategAt(q,q,k,g);h=u.pt2px(d.xoffset);var k=u.pt2px(d.yoffset),p;if(0!==h||0!==k)p=[h,-k];h=null;0!==d.angle&&(h=x.create(),y.rotategAt(h,
h,d.angle,g));var t;if("simple-marker"===d.type)switch(l=d.style,f=Math.round,m=n?m:u.pt2px(d.size),n=void 0,l){case r.STYLE_SQUARE:case r.STYLE_CROSS:case r.STYLE_X:case r.STYLE_DIAMOND:n=isNaN(m)?16:.5*m;l=A(a,e,E(l,c,b,f(c-n),f(c+n),f(b-n),f(b+n)));break;case r.STYLE_PATH:l=t=A(a,e,d.path);t=t.getBoundingBox();d=C(x.create(),[t.width,t.height],m);1===d[0]&&1===d[3]||y.scaleAt(q,q,d,g);t=[-(t.x+.5*t.width)+c,-(t.y+.5*t.height)+b];break;default:n=isNaN(m)?16:.5*m,l=F(a,e,{cx:c,cy:b,r:n})}else if("picture-marker"===
d.type){g=l=null;var k=u.pt2px(d.width),w=u.pt2px(d.height);n?(g=m,l=k/w*g):(l=k,g=w);p&&(null!=p[0]&&(p[0]=p[0]/k*l),null!=p[1]&&(p[1]=p[1]/w*g));l=G(a,e,{x:c-.5*l,y:b-.5*g,width:l,height:g,src:d.url});(m=l.getNode())&&(null!=f.opacity?m.setAttribute("opacity",f.opacity.toString()):m.setAttribute("opacity","1"))}else if("text"===d.type){if(f=d.font&&d.font.clone())f.size=n?m:u.pt2px(f.size);l=H(a,e,{type:"text",text:d.text,x:c,y:b,align:v.getSVGAlign(d),decoration:d.decoration||f&&f.decoration,rotated:d.rotated,
kerning:d.kerning});f&&l.setFont(f);m=l.getNode();a=v.getSVGBaseline(d);d=v.getSVGBaselineShift(d);m&&(m.setAttribute("dominant-baseline",a),d&&m.setAttribute("baseline-shift",d))}p&&x.translate(q,q,p);h&&x.multiply(q,q,h);t&&x.translate(q,q,t);l.setTransform(q);return l}function G(c,a,b){return a?a.setShape(b):c.createImage(b)}function F(c,a,b){return a?a.setShape(b):c.createCircle(b)}function A(c,a,b){b=Array.isArray(b)?b.join(" "):b;return a?a.setShape(b):c.createPath(b)}function H(c,a,b){return a?
a.setShape(b):c.createText(b)}function I(c,a){a=a&&a.shape&&a.shape.type;var b=c&&c.type;c=c&&c.style;b&&(c=N[b]||c);O[c]&&(c="path");return!(!a||!c||a===c)}function E(c,a,b,e,f,h,g,d){switch(c){case r.STYLE_SQUARE:return["M",e+","+h,f+","+h,f+","+g,e+","+g,"Z"];case r.STYLE_CROSS:return["M",a+","+h,a+","+g,"M",e+","+b,f+","+b];case r.STYLE_X:return["M",e+","+h,f+","+g,"M",e+","+g,f+","+h];case r.STYLE_DIAMOND:return["M",a+","+h,f+","+b,a+","+g,e+","+b,"Z"];case r.STYLE_TARGET:return["M",e+","+h,
f+","+h,f+","+g,e+","+g,e+","+h,"M",e-d+","+b,e+","+b,"M",a+","+(h-d),a+","+h,"M",f+d+","+b,f+","+b,"M",a+","+(g+d),a+","+g]}}function J(c,a){var b=a.symbol;if("picture-marker"!==b.type){var e=v.getFill(b);if("simple-marker"===b.type){var f=b.style,h=(b=v.getStroke(b))&&b.color,f=f===r.STYLE_X||f===r.STYLE_CROSS,g=a.opacity;(a=a.color||w([0,0,0,0],f?h:e))&&null!=g&&(a=z([0,0,0,0],a,g));a&&(f?a!==h&&(b=b?B.mixin({},b):{},b.color=a):a!==e&&(e=a));c.setFill(e).setStroke(b)}else"text"===b.type&&(g=a.opacity,
(a=a.color||w([0,0,0,0],e))&&null!=g&&(a=z([0,0,0,0],a,g)),a&&a!==e&&(e=a),c.setFill(e))}}Object.defineProperty(k,"__esModule",{value:!0});k.getScalingVector=C;var M={x:0,y:0},q=x.create();k.drawPoint=D;k.drawMarkers=function(c,a,b,e,f,h,g){var d=f.symbol;b=b.points;a=e||a.createGroup();e=[0];a.children[0]&&I(d,a.children[0])&&a.clear();for(var k=0,n=b.length,d=0;d<n;d++)for(var l=b[d],m=g.length,p=0;p<m;p++)e[0]=g[p],a.add(D(c,a,{x:l[0],y:l[1]},a.children[k++],f,h,e));c=a.children.length;if(b.length*
g.length<c)for(g=b.length*g.length,d=c-1;d>=g;d--)a.children[d].removeShape();return a};k.drawShape=function(c,a,b,e,f){var h=[];"extent"===b.type&&(b=K.fromExtent(b));if("polyline"===b.type||"polygon"===b.type){for(var g=f.length,d=0;d<g;d++)h=h.concat(c.toScreenPath(b,f[d]));e=A(a,e,h)}return e};k.drawRect=function(c,a,b){return a?a.setShape(b):c.createRect(b)};k.drawImage=G;k.drawCircle=F;k.drawPath=A;k.drawText=H;var N={"picture-marker":"image","picture-fill":"path","simple-fill":"path","simple-line":"path",
text:"text"},O={square:1,cross:1,x:1,diamond:1,target:1};k.isShapeInvalid=I;k.smsToPath=E;k.stylePoint=J;k.styleMarkers=function(c,a){for(var b=c.children.length,e=0;e<b;e++)J(c.children[e],a)};k.styleShape=function(c,a){var b=a.symbol,e=a.size,f=a.color,h=a.opacity,g=a.outlineSize;a=v.getStroke(b);var d=v.getFill(b),k=!1,n;"simple-line"===b.type?(k=!0,n="none"!==b.style):n=b.outline&&"none"!==b.outline.style;var l,m,p;if(null!=e||null!=g)if(e=e&&isFinite(e[0])&&e[0],g=k?null:g,null!=e||null!=g)p=
u.pt2px(g||e);e="picture-fill"===b.type;!f&&null==h||e||(k?(l=f||a&&a.color&&w([0,0,0,0],a.color))&&null!=h&&(l=z(l,l,h)):d&&(m=f||w([0,0,0,0],d))&&null!=h&&(m=z(m,m,h)));!n||null==p&&!l?c.setStroke(a):c.setStroke(B.mixin({},a,null!=p?{width:p}:null,l&&{color:l}));b=f&&new L(f)||b.color;d&&"pattern"===d.type&&b&&!e?v.getPatternUrlWithColor(d.src,b.toCss(!0)).then(function(a){d.src=a;c.setFill(d)}):c.setFill(m||d);c.rawNode.setAttribute("vector-effect","non-scaling-stroke")}});