// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ./Utils ./visualVariablesUtils ./LineTess ./MeshData ./TileClipper".split(" "),function(da,L,y,aa,a,ba,ca){function X(z,f,g,y,B){"butt"===B?r.buttCap(z,f,g):"round"===B?r.roundCap(z,f,g,y,a.getNumberOfSlices(Math.PI),y===a.CapPosition.START?-1:1):"square"===B?r.squareCap(z,f,g,y):(r.buttCap(z,f,g),console.error("Unknown cap type!"))}function T(a,f,g,r,B,h,J,D,G,k,m,c){var z=0,u;for(u=0;u<m.vectors.count;++u){var I=m.vectors.items[u].vector[0],v=m.vectors.items[u].vector[1],
H=m.vectors.items[u].texCoords[0],A=m.vectors.items[u].texCoords[1],q=m.vectors.items[u].direction[0],t=m.vectors.items[u].direction[1],l=G+z;++z;c.push(y.i1616to32(a,f));c.push(J);c.push(r);c.push(y.i8888to32(Math.round(31*I),Math.round(31*v),Math.round(31*H),Math.round(31*A)));c.push(y.i1616to32(g,31*D));c.push(y.i1616to32(B[0],B[1]));c.push(y.i1616to32(h[0],h[1]));c.push(y.i8888to32(Math.round(31*q),Math.round(31*t),0,0));k&&(c.push(k.size),c.push(k.color),c.push(k.opacity));m.vectors.items[u].base=
{index:l,point:[a,f]}}return z}function Y(a,f,g){r.bridge(Q,a,f);for(a=0;a<Q.count;++a)f=Q.items[a],g.push(f.v1.base.index,f.v2.base.index,f.v3.base.index)}Object.defineProperty(L,"__esModule",{value:!0});var r=new a.Tessellator({distanceAlongCorrection:!0}),R=new Float32Array(1),U=new Uint32Array(R.buffer),V=[a.allocExtrudeVectors(),a.allocExtrudeVectors()],Z=a.allocExtrudeVectors(),Q=a.allocTriangles(20),W=a.allocTriangles(20),M=new ca.TileClipper(0,0,0,1,8);M.setExtent(y.C_TILE_SIZE);L.createLineMeshData=
function(z,f,g,P,B,h,J,D,G){var k=null!=P?P.spriteMosaicItem:null,m=D.geometry,c=!y.isPictureSymbol(G)&&G.color?y.copyAndPremultiply(G.color):[255,255,255,1];P=y.numTo32(z);J=0<G.width?.5*(G.width+1/J):0;G=null!=k;var L=g.vvColor||g.vvOpacity||g.vvSizeMinMaxValue||g.vvSizeScaleStops||g.vvSizeFieldStops||g.vvSizeUnitValue,u=0,I=0,v=0;L&&(v=f.vvFields,u=v.opacity?f.getValue(D,v.opacity):0,I=v.color?f.getValue(D,v.color):0,v=v.size&&!g.vvSizeScaleStops?f.getValue(D,v.size):0,g.vvSizeUnitValue&&(v=aa.getVisualVariableSizeValueRepresentationRatio(v,
f.vvRanges.size.unitValue.valueRepresentation)),isNaN(v)&&(v=1),isNaN(u)&&(u=1),isNaN(I)&&(I=1),R[0]=v,v=U[0],R[0]=u,u=U[0],R[0]=I,I=U[0]);f=y.i8888to32(c[0],c[1],c[2],c[3]);g=[0,0];D=[0,0];if(k){var c=k.rect.x,H=k.rect.y,A=k.width,k=k.height;g[0]=c+1;g[1]=H+1;D[0]=c+1+A;D[1]=H+1+k}m=m.rings||m.paths;h*=8;k=-h;c=B+h;B=[];for(var H=m.length,A=0,q=!1;A<H;){var t=m[A];h=[];M.reset(2);var l=t[0][0],d=t[0][1];if(q)M.moveTo(l,d);else{if(l<k||l>c||d<k||d>c){q=!0;continue}h.push({x:l,y:d})}for(var K=!1,E=
t.length,x=1;x<E;++x)if(l+=t[x][0],d+=t[x][1],q)M.lineTo(l,d);else{if(l<k||l>c||d<k||d>c){K=!0;break}h.push({x:l,y:d})}if(K)q=!0;else{if(q){if(q=M.resultWithStarts())for(h=0;h<q.length;h++)B.push(q[h])}else B.push({line:h,start:0});A++;q=!1}}m=0;k=[];c=[];for(H=0;H<B.length;H++)if(t=B[H],h=t.line,!(2>h.length))for(A=h.length,l=h[0],d=h[A-1],q=d.x-l.x,l=d.y-l.y,q=1E-6>q*q+l*l,t=t.start,d=l=void 0,K=L?{size:v,color:I,opacity:u}:null,d=0;d<A;++d){x=h[d];E=l===V[d%2]?V[(d+1)%2]:V[d%2];if(d<A-1||!q||G){a:{var n=
E,p=d,C=h,w=A,S=q,F=C[p],b=[void 0,void 0],e=[void 0,void 0];if(0<p&&p<w-1){var N=C[(p+w-1)%w],O=C[(p+1)%w];a.normalize(b,[F.x-N.x,F.y-N.y]);a.normalize(e,[O.x-F.x,O.y-F.y])}else if(0===p)O=C[(p+1)%w],a.normalize(e,[O.x-F.x,O.y-F.y]),S?(C=C[w-2],a.normalize(b,[F.x-C.x,F.y-C.y])):b=e;else if(p===w-1)N=C[(p+w-1)%w],a.normalize(b,[F.x-N.x,F.y-N.y]),S?(C=C[1],a.normalize(e,[C.x-F.x,C.y-F.y])):e=b;else{console.error("Vertex index 'i' out of range.");break a}S||0!==p?S||p!==w-1?(p=a.getRads(b,e),p>Math.PI-
.05?r.rectJoin(n,b,e):.1>p?.05>p?r.fastMiterJoin(n,b,e):p<a.MITER_SAFE_RADS?r.miterJoin(n,b,e):r.bevelJoin(n,b,e,a.SYSTEM_MAG_LIMIT):(w=a.getNumberOfSlices(p),2.3>p?2>w||.5>p?r.bevelJoin(n,b,e,1):r.roundJoin(n,b,e,w):r.unitRoundJoin(n,b,e,w))):X(n,b,e,a.CapPosition.END,"round"):X(n,b,e,a.CapPosition.START,"round")}m+=T(x.x,x.y,t,f,g,D,P,J,m,K,E,k);if(E.capCenter&&(!q||d!==A-1))for(e=c,r.pie(W,E),b=void 0,b=0;b<W.count;++b)n=W.items[b],e.push(n.v1.base.index,n.v2.base.index,n.v3.base.index);q&&0===
d&&!G&&a.copyExtrudeVectors(Z,E)}else a.copyExtrudeVectors(E,Z);l&&Y(l,E,c);d<A-1&&(b=h[d+1],e=[b.x-x.x,b.y-x.y],n=a.length(e),e=[e[0]/n,e[1]/n],n=t+n,65535<n?(w=(65535-t)/(n-t),p=x.x+(b.x-x.x)*w,x=x.y+(b.y-x.y)*w,b=l,r.buttCap(b,e,e),m+=T(p,x,65535,f,g,D,z,J,m,K,b,k),r.bridge(Q,E,b),Y(E,b,c),r.buttCap(b,e,e),m+=T(p,x,0,f,g,D,z,J,m,K,b,k),t=n-t):(t=n,l=E))}z=new ba;z.update({geometry:k},m,c);return z}});