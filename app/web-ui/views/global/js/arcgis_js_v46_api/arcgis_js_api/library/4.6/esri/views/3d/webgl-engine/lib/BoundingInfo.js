// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["require","exports","./Util","./gl-matrix"],function(y,z,n,x){var p=x.vec3d;return function(){function f(b,k,f,c){n.assert(1<=b.length);n.assert(0===f.length%k);n.assert(f.length>=b.length*k);n.assert(3===c.size||4===c.size);this.primitiveIndices=b;this.indices=f;this._position=c;this._numIndexPerPrimitive=k;var a=c.data,m=c.offsetIdx;c=c.strideIdx;var r=b.length,d=m+c*f[k*b[0]];this.bbMin=p.createFrom(a[d],a[d+1],a[d+2]);this.bbMax=p.create(this.bbMin);for(var g=0;g<r;++g)for(var q=k*b[g],
e=0;e<k;++e)for(var d=m+c*f[q+e],h=0;3>h;++h){var l=a[d+h];l<this.bbMin[h]?this.bbMin[h]=l:l>this.bbMax[h]&&(this.bbMax[h]=l)}this.center=p.create();p.lerp(this.bbMin,this.bbMax,.5,this.center);for(g=this.bsRadius=0;g<r;++g)for(q=k*b[g],e=0;e<k;++e)d=m+c*f[q+e],h=a[d]-this.center[0],l=a[d+1]-this.center[1],d=a[d+2]-this.center[2],d=h*h+l*l+d*d,d>this.bsRadius&&(this.bsRadius=d);this.bsRadius=Math.sqrt(this.bsRadius)}f.prototype.getCenter=function(){return this.center};f.prototype.getBSRadius=function(){return this.bsRadius};
f.prototype.getBBMin=function(){return this.bbMin};f.prototype.getBBMax=function(){return this.bbMax};f.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};f.prototype.getIndices=function(){return this.indices};f.prototype.getPosition=function(){return this._position};f.prototype.getChildren=function(){if(this.children)return this.children;if(1<p.dist2(this.bbMin,this.bbMax)){for(var b=p.lerp(this.bbMin,this.bbMax,.5,p.create()),k=this.primitiveIndices.length,n=new Uint8Array(k),
c=Array(8),a=0;8>a;++a)c[a]=0;for(var a=this._position,m=a.data,r=a.offsetIdx,d=a.strideIdx,a=0;a<k;++a){for(var g=0,q=this._numIndexPerPrimitive*this.primitiveIndices[a],e=r+d*this.indices[q],h=m[e],l=m[e+1],t=m[e+2],u=1;u<this._numIndexPerPrimitive;++u){var e=r+d*this.indices[q+u],v=m[e],w=m[e+1],e=m[e+2];v<h&&(h=v);w<l&&(l=w);e<t&&(t=e)}h<b[0]&&(g|=1);l<b[1]&&(g|=2);t<b[2]&&(g|=4);n[a]=g;++c[g]}for(a=b=0;8>a;++a)0<c[a]&&++b;if(2>b)return;b=Array(8);for(a=0;8>a;++a)b[a]=0<c[a]?new Uint32Array(c[a]):
void 0;for(a=0;8>a;++a)c[a]=0;for(a=0;a<k;++a)g=n[a],b[g][c[g]++]=this.primitiveIndices[a];this.children=Array(8);for(a=0;8>a;++a)void 0!==b[a]&&(this.children[a]=new f(b[a],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return f}()});