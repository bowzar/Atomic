// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define(["./GeometryData","./BufferVectorMath","./Util","./gl-matrix"],function(B,Q,L,O){function P(a,c,b,d,g){if(Math.abs(e.dot(c,a))>g)return!1;e.cross(a,c,b);e.normalize(b);e.cross(b,a,d);e.normalize(d);return!0}var e=O.vec3,Z=O.vec4,R=O.vec3d,l=L.VertexAttrConstants,G=Q.Vec3Compact,H=R.create(),U=R.create(),Y={createSphereGeometry:function(a,c,b,d,g,k,f){a=a||50;d=void 0!==d?d:-Math.PI;g=void 0!==g?g:2*Math.PI;k=void 0!==k?k:.5*-Math.PI;f=void 0!==f?f:Math.PI;var m=Math.max(3,Math.floor(c)||8),
h=Math.max(2,Math.floor(b)||6),q=(m+1)*(h+1);b=new Float32Array(3*q);c=new Float32Array(3*q);var q=new Float32Array(2*q),p,t,v=[],A=e.create(),u=0;for(t=0;t<=h;t++){var n=[],r=t/h,w=k+r*f,C=Math.cos(w);for(p=0;p<=m;p++){var x=p/m,z=d+x*g,N=Math.cos(z)*C*a,D=Math.sin(w)*a,z=-Math.sin(z)*C*a;b[3*u]=N;b[3*u+1]=D;b[3*u+2]=z;e.set3(N,D,z,A);e.normalize(A);c[3*u]=A[0];c[3*u+1]=A[1];c[3*u+2]=A[2];q[2*u]=x;q[2*u+1]=r;n.push(u);++u}v.push(n)}a=new Uint32Array(2*m*(h-1)*3);for(t=u=0;t<h;t++)for(p=0;p<m;p++)d=
v[t][p],g=v[t][p+1],k=v[t+1][p+1],f=v[t+1][p],0===t?(a[u++]=d,a[u++]=k,a[u++]=f):t===h-1?(a[u++]=d,a[u++]=g,a[u++]=k):(a[u++]=d,a[u++]=g,a[u++]=k,a[u++]=k,a[u++]=f,a[u++]=d);L.assert(u===a.length);m={};m[l.POSITION]=a;m[l.NORMAL]=a;m[l.UV0]=a;h={};h[l.POSITION]={size:3,data:b};h[l.NORMAL]={size:3,data:c};h[l.UV0]={size:2,data:q};return new B(h,m)},createPolySphereGeometry:function(a,c,b){function d(b,d){b>d&&(b=d+(d=b,0));var c=b.toString()+"."+d.toString();if(f[c])return f[c];var g=k.length;k.length+=
3;G.add(k,3*b,k,3*d,k,g);G.scale(k,g,a/G.length(k,g));g/=3;return f[c]=g}var g,k;b?(k=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],b=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(b=a*(1+Math.sqrt(5))/2,k=[-a,b,0,a,b,0,-a,-b,0,a,-b,0,0,-a,b,0,a,b,0,-a,-b,0,a,-b,b,0,-a,b,0,a,-b,0,-a,-b,0,a],b=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(g=0;g<k.length;g+=3)G.scale(k,g,a/G.length(k,g));var f={};for(g=0;g<c;g++){for(var e=
b.length,h=new Uint32Array(4*e),q=0;q<e;q+=3){var p=b[q],t=b[q+1],v=b[q+2],A=d(p,t),u=d(t,v),n=d(v,p),r=4*q;h[r]=p;h[r+1]=A;h[r+2]=n;h[r+3]=t;h[r+4]=u;h[r+5]=A;h[r+6]=v;h[r+7]=n;h[r+8]=u;h[r+9]=A;h[r+10]=u;h[r+11]=n}b=h;f={}}c=new Float32Array(k);for(g=0;g<c;g+=3)G.normalize(c,g);k=new Float32Array(k);g={};g[l.POSITION]=b;g[l.NORMAL]=b;b={};b[l.POSITION]={size:3,data:k};b[l.NORMAL]={size:3,data:c};return new B(b,g)},createPointGeometry:function(a,c,b,d,g,k,f){var e=new Float32Array(3);e[0]=c?c[0]:
0;e[1]=c?c[1]:0;e[2]=c?c[2]:0;c=new Float32Array(3);c[0]=a?a[0]:0;c[1]=a?a[1]:0;c[2]=a?a[2]:1;if(null==k)a=new Float32Array(2),a[0]=0,a[1]=0;else{a=new Float32Array(k.length);for(var h=0;h<k.length;h++)a[h]=k[h]}k=new Uint8Array(4);k[0]=b?255*b[0]:255;k[1]=b?255*b[1]:255;k[2]=b?255*b[2]:255;k[3]=b&&3<b.length?255*b[3]:255;b=new Float32Array(2);b[0]=null!=d&&2==d.length?d[0]:1;b[1]=null!=d&&2==d.length?d[1]:1;if(null!=g){var q=new Float32Array(4);q[0]=g[0];q[1]=g[1];q[2]=g[2];q[3]=g[3]}if(null!=f){var p=
new Float32Array(4);p[0]=f[0];p[1]=f[1];p[2]=f[2];p[3]=f[3]}h=new Uint32Array(1);h[0]=0;d={};d[l.POSITION]=h;d[l.NORMAL]=h;d[l.UV0]=h;d[l.COLOR]=h;d[l.SIZE]=h;null!=g&&(d[l.AUXPOS1]=h);null!=f&&(d[l.AUXPOS2]=h);h={};h[l.POSITION]={size:3,data:e};h[l.NORMAL]={size:3,data:c};h[l.UV0]={size:a.length,data:a};h[l.COLOR]={size:4,data:k};h[l.SIZE]={size:2,data:b};null!=g&&(h[l.AUXPOS1]={size:4,data:q});null!=f&&(h[l.AUXPOS2]={size:4,data:p});return new B(h,d,B.DefaultOffsets,"point")},createPointArrayGeometry:function(a,
c){for(var b=new Float32Array(3*a.length),d=new Float32Array(c?3*a.length:3),g=new Uint32Array(a.length),e=new Uint32Array(a.length),f=0;f<a.length;f++)b[3*f]=a[f][0],b[3*f+1]=a[f][1],b[3*f+2]=a[f][2],c&&(d[3*f]=c[f][0],d[3*f+1]=c[f][1],d[3*f+2]=c[f][2]),g[f]=f,e[f]=0;c||(d[0]=0,d[1]=1,d[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;f={};f[l.POSITION]=g;f[l.NORMAL]=c?g:e;f[l.UV0]=e;c={};c[l.POSITION]={size:3,data:b};c[l.NORMAL]={size:3,data:d};c[l.UV0]={size:2,data:a};return new B(c,f,B.DefaultOffsets,
"point")},createTriangleGeometry:function(){var a=new Float32Array(9);a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=100;a[6]=100;a[7]=0;a[8]=0;var c=new Uint32Array(3);c[0]=0;c[1]=1;c[2]=2;var b=new Float32Array(3);b[0]=0;b[1]=1;b[2]=0;var d=new Uint32Array(3);d[0]=0;d[1]=0;d[2]=0;var g=new Float32Array(2);g[0]=0;g[1]=0;var e=new Uint32Array(3);e[0]=0;e[1]=0;e[2]=0;var f={};f[l.POSITION]=c;f[l.NORMAL]=d;f[l.UV0]=e;c={};c[l.POSITION]={size:3,data:a};c[l.NORMAL]={size:3,data:b};c[l.UV0]={size:2,data:g};return new B(c,
f)},createSquareGeometry:function(a){var c,b,d=new Float32Array(12);if(a)for(c=0;4>c;c++)for(b=0;3>b;b++)d[3*c+b]=a[c][b];else d[0]=-1,d[1]=-1,d[2]=0,d[3]=1,d[4]=-1,d[5]=0,d[6]=1,d[7]=1,d[8]=0,d[9]=-1,d[10]=1,d[11]=0;b=new Uint32Array(6);b[0]=0;b[1]=1;b[2]=2;b[3]=2;b[4]=3;b[5]=0;a=new Float32Array(3);a[0]=0;a[1]=0;a[2]=1;var g=new Uint32Array(6);for(c=0;6>c;c++)g[c]=0;c=new Float32Array(8);c[0]=0;c[1]=0;c[2]=1;c[3]=0;c[4]=1;c[5]=1;c[6]=0;c[7]=1;var e=new Uint8Array(4);e[0]=255;e[1]=255;e[2]=255;e[3]=
255;var f={};f[l.POSITION]=b;f[l.NORMAL]=g;f[l.UV0]=b;f[l.COLOR]=g;b={};b[l.POSITION]={size:3,data:d};b[l.NORMAL]={size:3,data:a};b[l.UV0]={size:2,data:c};b[l.COLOR]={size:4,data:e};return new B(b,f)},createBoxGeometry:function(){var a,c,b=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],g=[0,0,1,0,1,1,0,1],e=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],f=Array(36);for(a=0;6>
a;a++)for(c=0;6>c;c++)f[6*a+c]=a;var m=Array(36);for(a=0;6>a;a++)m[6*a+0]=0,m[6*a+1]=1,m[6*a+2]=2,m[6*a+3]=2,m[6*a+4]=3,m[6*a+5]=0;return function(a){var c;Array.isArray(a)||(a=[a,a,a]);var k=new Float32Array(24);for(c=0;8>c;c++)k[3*c]=b[c][0]*a[0],k[3*c+1]=b[c][1]*a[1],k[3*c+2]=b[c][2]*a[2];a={};a[l.POSITION]=new Uint32Array(e);a[l.NORMAL]=new Uint32Array(f);a[l.UV0]=new Uint32Array(m);c={};c[l.POSITION]={size:3,data:k};c[l.NORMAL]={size:3,data:new Float32Array(d)};c[l.UV0]={size:2,data:new Float32Array(g)};
return new B(c,a)}}(),createDiamondGeometry:function(){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],c=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],b=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],d=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];return function(g){var e;Array.isArray(g)||(g=[g,g,g]);var f=new Float32Array(18);for(e=0;6>e;e++)f[3*e]=a[e][0]*g[0],f[3*e+1]=a[e][1]*g[1],f[3*e+2]=a[e][2]*g[2];g={};g[l.POSITION]=new Uint32Array(b);g[l.NORMAL]=
new Uint32Array(d);e={};e[l.POSITION]={size:3,data:f};e[l.NORMAL]={size:3,data:new Float32Array(c)};return new B(e,g)}}(),createTetrahedronGeometry:function(){var a=e.createFrom(-.5,0,-.5),c=e.createFrom(.5,0,-.5),b=e.createFrom(0,0,.5),d=e.createFrom(0,.5,0),g=e.create(),k=e.create(),f=e.create(),m=e.create(),h=e.create();e.subtract(a,d,g);e.subtract(a,c,k);e.cross(g,k,f);e.normalize(f,f);e.subtract(c,d,g);e.subtract(c,b,k);e.cross(g,k,m);e.normalize(m,m);e.subtract(b,d,g);e.subtract(b,a,k);e.cross(g,
k,h);e.normalize(h,h);var q=[a,c,b,d],p=[0,-1,0,f[0],f[1],f[2],m[0],m[1],m[2],h[0],h[1],h[2]],t=[0,1,2,3,1,0,3,2,1,3,0,2],v=[0,0,0,1,1,1,2,2,2,3,3,3];return function(a){var b;Array.isArray(a)||(a=[a,a,a]);var c=new Float32Array(12);for(b=0;4>b;b++)c[3*b]=q[b][0]*a[0],c[3*b+1]=q[b][1]*a[1],c[3*b+2]=q[b][2]*a[2];a={};a[l.POSITION]=new Uint32Array(t);a[l.NORMAL]=new Uint32Array(v);b={};b[l.POSITION]={size:3,data:c};b[l.NORMAL]={size:3,data:new Float32Array(p)};return new B(b,a)}}(),createConeGeometry:function(a,
c,b,d){var g=0,k=e.createFrom(0,g,0),f=e.createFrom(0,g+a,0),m=e.createFrom(0,-1,0),h=e.createFrom(0,1,0);d&&(g=a,f=e.createFrom(0,0,0),k=e.createFrom(0,g,0),m=e.createFrom(0,1,0),h=e.createFrom(0,-1,0));var k=[f,k],m=[m,h],h=b+2,q=0,f=Math.sqrt(a*a+c*c);if(d)for(d=b-1;0<=d;d--)q=2*Math.PI/b*d,p=e.createFrom(Math.cos(q)*c,g,Math.sin(q)*c),k.push(p),q=e.createFrom(a*Math.cos(q)/f,-c/f,a*Math.sin(q)/f),m.push(q);else for(d=0;d<b;d++){var q=2*Math.PI/b*d,p=e.createFrom(Math.cos(q)*c,g,Math.sin(q)*c);
k.push(p);q=e.createFrom(a*Math.cos(q)/f,c/f,a*Math.sin(q)/f);m.push(q)}a=new Uint32Array(6*(b+2));b=new Uint32Array(6*(b+2));g=c=0;for(d=3;d<k.length;d++)a[c++]=1,a[c++]=d-1,a[c++]=d,b[g++]=0,b[g++]=0,b[g++]=0;a[c++]=k.length-1;a[c++]=2;a[c++]=1;b[g++]=0;b[g++]=0;b[g++]=0;for(d=3;d<k.length;d++)a[c++]=d,a[c++]=d-1,a[c++]=0,b[g++]=d,b[g++]=d-1,b[g++]=1;a[c++]=0;a[c++]=2;a[c++]=k.length-1;b[g++]=1;b[g++]=2;b[g++]=m.length-1;g=1;Array.isArray(g)||(g=[g,g,g]);c=new Float32Array(3*h);for(d=0;d<h;d++)c[3*
d]=k[d][0]*g[0],c[3*d+1]=k[d][1]*g[1],c[3*d+2]=k[d][2]*g[2];k=new Float32Array(3*h);for(d=0;d<h;d++)k[3*d]=m[d][0],k[3*d+1]=m[d][1],k[3*d+2]=m[d][2];m={};m[l.POSITION]=a;m[l.NORMAL]=b;h={};h[l.POSITION]={size:3,data:c};h[l.NORMAL]={size:3,data:k};return new B(h,m)},createCylinderGeometry:function(a,c,b,d,g,k){d||(d=e.createFrom(1,0,0));g||(g=e.createFrom(0,0,0));k=void 0===k?!0:k;var f=e.create();e.normalize(d,f);d=e.create();e.scale(f,Math.abs(a),d);var m=e.create();e.scale(d,-.5,m);e.add(m,g);var h=
e.createFrom(0,1,0);Math.abs(.2>1-e.dot(f,h))&&e.set3(0,0,1,h);var q=e.create();e.cross(f,h,q);e.normalize(q);e.cross(q,f,h);var p=2*b+(k?2:0),t=b+(k?2:0);g=new Float32Array(3*p);a=new Float32Array(3*t);var v=new Float32Array(2*p),A=new Uint32Array(3*b*(k?4:2)),u=new Uint32Array(3*b*(k?4:2));k&&(g[3*(p-2)+0]=m[0],g[3*(p-2)+1]=m[1],g[3*(p-2)+2]=m[2],v[2*(p-2)]=0,v[2*(p-2)+1]=0,g[3*(p-1)+0]=g[3*(p-2)+0]+d[0],g[3*(p-1)+1]=g[3*(p-2)+1]+d[1],g[3*(p-1)+2]=g[3*(p-2)+2]+d[2],v[2*(p-1)]=1,v[2*(p-1)+1]=1,a[3*
(t-2)+0]=-f[0],a[3*(t-2)+1]=-f[1],a[3*(t-2)+2]=-f[2],a[3*(t-1)+0]=f[0],a[3*(t-1)+1]=f[1],a[3*(t-1)+2]=f[2]);var f=function(a,b,c){A[a]=b;u[a]=c},n,r,w=0,C=e.create(),x=e.create();for(n=0;n<b;n++)r=2*Math.PI/b*n,e.scale(h,Math.sin(r),C),e.scale(q,Math.cos(r),x),e.add(C,x),a[3*n+0]=C[0],a[3*n+1]=C[1],a[3*n+2]=C[2],e.scale(C,c),e.add(C,m),g[3*n+0]=C[0],g[3*n+1]=C[1],g[3*n+2]=C[2],v[2*n+0]=n/b,v[2*n+1]=0,g[3*(n+b)+0]=g[3*n+0]+d[0],g[3*(n+b)+1]=g[3*n+1]+d[1],g[3*(n+b)+2]=g[3*n+2]+d[2],v[2*(n+b)+0]=n/b,
v[2*n+1]=1,r=(n+1)%b,f(w++,n,n),f(w++,n+b,n),f(w++,r,r),f(w++,r,r),f(w++,n+b,n),f(w++,r+b,r);if(k){for(n=0;n<b;n++)r=(n+1)%b,f(w++,p-2,t-2),f(w++,n,t-2),f(w++,r,t-2);for(n=0;n<b;n++)r=(n+1)%b,f(w++,n+b,t-1),f(w++,p-1,t-1),f(w++,r+b,t-1)}c={};c[l.POSITION]=A;c[l.NORMAL]=u;c[l.UV0]=A;b={};b[l.POSITION]={size:3,data:g};b[l.NORMAL]={size:3,data:a};b[l.UV0]={size:2,data:v};return new B(b,c)},createTubeGeometry:function(a,c,b,d,e){b=b||10;d=null!=d?d:!0;L.assert(1<a.length);for(var g=[],f=[],m=0;m<b;m++){g.push([0,
-m-1,-((m+1)%b)-1]);var h=m/b*2*Math.PI;f.push([Math.cos(h)*c,Math.sin(h)*c])}return Y.createPathExtrusionGeometry(f,a,[[0,0,0]],g,d,e)},createPathExtrusionGeometry:function(a,c,b,d,g,k){var f,m=a.length,h=new Float32Array(c.length*m*3+(6*b.length||0)),q=new Float32Array(c.length*m+(2*b.length||0)),p=new Float32Array(c.length*m*3+(b?6:0)),t=0,v=0,A=0,u=(c.length-1)*m*6+6*d.length,n=new Uint32Array(u),u=new Uint32Array(u),r=0,w=0,C=e.create(),x=e.create(),z=e.create(),N=e.create();e.create();var D=
e.create();e.create();e.create();var y=e.create(),G=e.create(),E=e.create(),H=e.create(),M=e.create();e.create();e.create();var O=e.create(),V=e.create(),Q=e.create(),S=Z.create();e.set3(0,1,0,H);e.subtract(c[1],c[0],x);e.normalize(x);g?(e.add(c[0],k,E),e.normalize(E,z)):e.set3(0,0,1,z);P(x,z,D,z,.99619469809)||P(x,H,D,z,.99619469809)||P(x,H,D,z,.99619469809);e.set(z,N);e.set(D,V);for(f=0;f<b.length;f++)e.scale(D,b[f][0],y),e.scale(z,b[f][2],E),e.add(y,E),e.add(y,c[0]),h[t++]=y[0],h[t++]=y[1],h[t++]=
y[2],q[A++]=0;p[v++]=-x[0];p[v++]=-x[1];p[v++]=-x[2];for(f=0;f<d.length;f++)n[r++]=0<d[f][0]?d[f][0]:-d[f][0]-1+b.length,n[r++]=0<d[f][1]?d[f][1]:-d[f][1]-1+b.length,n[r++]=0<d[f][2]?d[f][2]:-d[f][2]-1+b.length,u[w++]=0,u[w++]=0,u[w++]=0;var I=b.length;f=b.length-1;for(var T,J=0;J<c.length;J++){T=!1;if(0<J){e.set(x,C);J<c.length-1?(e.subtract(c[J+1],c[J],x),e.normalize(x)):T=!0;e.add(C,x,M);e.normalize(M);e.add(c[J-1],N,O);S[0]=M[0];S[1]=M[1];S[2]=M[2];S[3]=-R.dot(M,c[J]);if(L.rayPlane(O,C,S,E))e.subtract(E,
c[J]),e.normalize(E,z),e.cross(M,z,D),e.normalize(D);else{var F=M,K=V,U=H,W=D,X=z;P(F,N,W,X,.99619469809)||P(F,K,W,X,.99619469809)||P(F,U,W,X,.99619469809)}e.set(z,N);e.set(D,V)}g&&(e.add(c[J],k,E),e.normalize(E,Q));for(F=0;F<m;F++)if(e.scale(D,a[F][0],y),e.scale(z,a[F][1],E),e.add(y,E),e.normalize(y,G),p[v++]=G[0],p[v++]=G[1],p[v++]=G[2],g?q[A++]=e.dot(y,Q):q[A++]=y[2],e.add(y,c[J]),h[t++]=y[0],h[t++]=y[1],h[t++]=y[2],!T)for(K=(F+1)%m,n[r++]=I+F,n[r++]=I+m+F,n[r++]=I+K,n[r++]=I+K,n[r++]=I+m+F,n[r++]=
I+m+K,K=0;6>K;K++)u[w++]=n[r-6+K]-f;I+=m}T=c[c.length-1];for(f=0;f<b.length;f++)e.scale(D,b[f][0],y),e.scale(z,b[f][1],E),e.add(y,E),e.add(y,T),h[t++]=y[0],h[t++]=y[1],h[t++]=y[2],q[A++]=0;a=v/3;p[v++]=x[0];p[v++]=x[1];p[v++]=x[2];m=I-m;for(f=0;f<d.length;f++)n[r++]=0<=d[f][0]?I+d[f][0]:-d[f][0]-1+m,n[r++]=0<=d[f][2]?I+d[f][2]:-d[f][2]-1+m,n[r++]=0<=d[f][1]?I+d[f][1]:-d[f][1]-1+m,u[w++]=a,u[w++]=a,u[w++]=a;d={};d[l.POSITION]=n;d[l.NORMAL]=u;n={};n[l.POSITION]={size:3,data:h};n.zOffset={size:1,data:q};
n[l.NORMAL]={size:3,data:p};return new B(n,d)},createPolylineGeometry:function(a,c){L.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");L.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");L.assert(void 0===c||c.length===a.length,"createPolylineGeometry: need same number of points and normals");L.assert(void 0===c||3===c[0].length,"createPolylineGeometry(): malformed normal");for(var b=new Float32Array(3*a.length),d=new Uint32Array(2*(a.length-1)),e=
0,k=0,f=0;f<a.length;f++){for(var m=0;3>m;m++)b[e++]=a[f][m];0<f&&(d[k++]=f-1,d[k++]=f)}e={};k={};e[l.POSITION]=d;k[l.POSITION]={size:3,data:b};if(c){for(var b=new Float32Array(3*c.length),h=0,f=0;f<a.length;f++)for(m=0;3>m;m++)b[h++]=c[f][m];e[l.NORMAL]=d;k[l.NORMAL]={size:3,data:b}}return new B(k,e,B.DefaultOffsets,"line")},addVertexColors:function(a,c){var b,d=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*d[0];c[1]=255*d[1];c[2]=255*d[2];c[3]=255*(3<d.length?d[3]:1);var d={},e=a.getVertexAttr();for(b in e)d[b]=
e[b];d[l.COLOR]={size:4,data:c};c={};for(b in a.indices)c[b]=a.indices[b];c[l.COLOR]=new Uint32Array(c[l.POSITION].length);return a=new B(d,c,a.componentOffsets,a.primitiveType)},addNormals:function(a){var c=a.getVertexAttr();a=a.indices;for(var b=Q.Vec3Compact.subtract,d=new Float32Array(a.position.length/3*3),e=c.position.data,k=0,f=a.position,m=new Uint32Array(f.length),h=0;h<f.length;h+=3){b(e,3*f[h],e,3*f[h+2],U,0);b(e,3*f[h],e,3*f[h+1],H,0);R.cross(H,U);R.normalize(H);var l=k/3;d[k++]=H[0];
d[k++]=H[1];d[k++]=H[2];m[h]=l;m[h+1]=l;m[h+2]=l}c.normal={size:3,data:d};a.normal=m},cgToGIS:function(a){var c=a.getVertexAttr();a=c.position.data;var c=c.normal.data,b,d;if(c)for(b=0;b<c.length;b+=3)d=c[b+1],c[b+1]=-c[b+2],c[b+2]=d;if(a)for(b=0;b<a.length;b+=3)d=a[b+1],a[b+1]=-a[b+2],a[b+2]=d}};return Y});