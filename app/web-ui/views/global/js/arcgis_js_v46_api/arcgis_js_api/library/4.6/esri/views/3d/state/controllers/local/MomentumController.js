// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.6/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../AnimationController ../../../webgl-engine/lib/Camera ../../../lib/glMatrix ../../utils/navigationUtils ../../../../navigation/Momentum ../../../camera/constraintUtils".split(" "),function(k,l,n,p,q,c,m,g,h){Object.defineProperty(l,"__esModule",{value:!0});k=function(f){function b(e){var a=f.call(this)||this;a.view=e;a.zoom={momentum:null,estimator:new g.ZoomMomentumEstimator(.05),enabled:!0};a.rotation={momentum:null,estimator:new g.RotationMomentumEstimator(.05,
3,.05,.95),enabled:!0};a.pan={momentum:null,estimator:new g.ScreenspaceMomentumEstimator(.05,500,12,.82),enabled:!0};a._scaleState={center:c.vec3d.create()};a._rotationState={center:c.vec3d.create(),axis:c.vec3d.create()};a._panState={direction:c.vec3d.create()};a.elapsedTimeSec=0;a.zoomDirection=c.vec3d.create();a.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new q,interactionDirection:null};return a}n(b,f);b.prototype.addPanValue=function(e,a,d,b){this.pan.estimator.add(a[0],
a[1],d,.001*e);c.vec3d.set(b,this._panState.direction);c.vec3d.normalize(this._panState.direction)};b.prototype.addRotationValue=function(e,a,d,b){this.rotation.estimator.add(b,.001*e);c.vec3d.set(a,this._rotationState.center);c.vec3d.set(d,this._rotationState.axis)};b.prototype.addScaleValue=function(e,a,b){this.zoom.estimator.add(a,.001*e);c.vec3d.set(b,this._scaleState.center)};b.prototype.initiate=function(){this.zoom.enabled&&(this.zoom.momentum=this.zoom.estimator.evaluateMomentum());!this.zoom.momentum&&
this.rotation.enabled&&(this.rotation.momentum=this.rotation.estimator.evaluateMomentum());this.zoom.momentum||this.rotation.momentum||!this.pan.enabled||(this.pan.momentum=this.pan.estimator.evaluateMomentum());return null!=(this.zoom.momentum||this.rotation.momentum||this.pan.momentum)};Object.defineProperty(b.prototype,"steppingFinished",{get:function(){this.zoom.momentum&&this.zoom.momentum.isFinished(this.elapsedTimeSec)&&(this.zoom.momentum=null);this.rotation.momentum&&this.rotation.momentum.isFinished(this.elapsedTimeSec)&&
(this.rotation.momentum=null);this.pan.momentum&&this.pan.momentum.isFinished(this.elapsedTimeSec)&&(this.pan.momentum=null);return!this.zoom.momentum&&!this.rotation.momentum&&!this.pan.momentum},enumerable:!0,configurable:!0});b.prototype.onControllerStart=function(c){this.constraintOptions.interactionStartCamera.copyFrom(c);this.constraintOptions.interactionDirection=null;f.prototype.onControllerStart.call(this,c)};b.prototype.stepController=function(b,a){f.prototype.stepController.call(this,b,
a);if(this.zoom.momentum){c.vec3d.normalize(c.vec3d.subtract(this._scaleState.center,a.eye,this.zoomDirection));this.constraintOptions.interactionDirection=this.zoomDirection;this.constraintOptions.interactionType=1;var d=this.zoom.momentum.valueDelta(this.elapsedTimeSec,b);m.applyZoomToPoint(a,this._scaleState.center,d,this.view.state.constraints.minimumPoiDistance);h.applyAll(this.view,a,this.constraintOptions)}this.pan.momentum&&(c.vec3d.normalize(this._panState.direction),d=c.vec3d.dist(this.pan.momentum.dataOldest,
this.pan.momentum.dataNewest),d/=this.pan.momentum.dataTimeDelta,d*=this.pan.momentum.velocityFactor(this.elapsedTimeSec),c.vec3d.scale(this._panState.direction,d*b),c.vec3d.subtract(a.eye,this._panState.direction),c.vec3d.subtract(a.center,this._panState.direction),a.markViewDirty(),this.constraintOptions.interactionType=4,h.applyAll(this.view,a,this.constraintOptions));this.rotation.momentum&&(d=this.rotation.momentum.valueDelta(this.elapsedTimeSec,b),m.applyRotation(a,this._rotationState.center,
this._rotationState.axis,d),this.constraintOptions.interactionType=2,h.applyAll(this.view,a,this.constraintOptions));this.elapsedTimeSec+=b};return b}(p.AnimationController);l.MomentumController=k});